<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="propop">
<title>Prepare data • propop</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Inter-0.4.7/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.7/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare data">
<meta property="og:description" content="propop">
<meta property="og:image" content="https://statistik-aargau.github.io/propop/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
<p>



  pkgdown/extra.scss

  

  </p>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">propop</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/prepare_data.html">Prepare data</a>
    <a class="dropdown-item" href="../articles/run_projections.html">Run projections</a>
    <a class="dropdown-item" href="../articles/evaluate.html">Evaluate projections</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/statistik-aargau/propop/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="prepare_data_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="prepare_data_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="prepare_data_files/datatables-binding-0.30/datatables.js"></script><link href="prepare_data_files/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="prepare_data_files/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="prepare_data_files/dt-core-1.13.4/js/jquery.dataTables.min.js"></script><link href="prepare_data_files/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="prepare_data_files/crosstalk-1.2.0/js/crosstalk.min.js"></script><link href="prepare_data_files/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="prepare_data_files/nouislider-7.0.10/jquery.nouislider.min.js"></script><link href="prepare_data_files/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="prepare_data_files/selectize-0.12.0/selectize.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Prepare data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/statistik-aargau/propop/blob/HEAD/vignettes/prepare_data.Rmd" class="external-link"><code>vignettes/prepare_data.Rmd</code></a></small>
      <div class="d-none name"><code>prepare_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette shows how to obtain and prepare the relevant
information to run population projections with the package
<code>propop</code> at the level of a Canton.</p>
<p>Most of the information and data required to run
<code><a href="../reference/propop.html">propop::propop()</a></code> (or <code><a href="../reference/project_raw.html">propop::project_raw()</a></code>)
can be downloaded from <a href="https://www.pxweb.bfs.admin.ch/pxweb" class="external-link">STAT-TAB</a>. More
specifically, the information from the following tables are needed:</p>
<table style="width:99%;" class="table">
<caption>Overview of required FSO tables (STAT-TAB)</caption>
<colgroup>
<col width="24%">
<col width="39%">
<col width="34%">
</colgroup>
<thead><tr class="header">
<th>Table ID</th>
<th>Parameters expressed as…</th>
<th>Variables required for projection</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>px- x-0104020000_101</td>
<td>number of people (<em>reference</em> scenario)</td>
<td><ul>
<li>Inter-cantonal immigration</li>
<li>Inter-cantonal emigration</li>
<li>International immigration</li>
<li>International emigration</li>
<li>end of year population size</li>
</ul></td>
</tr>
<tr class="even">
<td>px- x-0104020000_102</td>
<td>number of people (<em>high growth</em> scenario)</td>
<td><ul>
<li>same as 101</li>
</ul></td>
</tr>
<tr class="odd">
<td>px- x-0104020000_103</td>
<td>number of people (<em>low growth</em> scenario)</td>
<td><ul>
<li>same as 101</li>
</ul></td>
</tr>
<tr class="even">
<td>px- x-0104020000_109</td>
<td>rates / probabilities (five scenarios)</td>
<td><ul>
<li><p>Births per mother</p></li>
<li><p>Mortality</p></li>
<li><p>International emigration</p></li>
<li><p>Inter-cantonal emigration</p></li>
<li><p>Acquisition of Swiss citizenship</p></li>
</ul></td>
</tr>
<tr class="odd">
<td>px -x-0104020000_106</td>
<td>share of newborns with Swiss nationality born to non-Swiss
mothers</td>
<td><ul>
<li><p>Live newborns</p></li>
<li><p>Live births by age and nationality of the mother (varies between
cantons)</p></li>
</ul></td>
</tr>
<tr class="even">
<td>Constant parameters <strong>not</strong> directly available from
STAT-TAB must be provided as arguments</td>
<td></td>
<td><ul>
<li><p>Start (16) and end (50) of the fertile age of women</p></li>
<li><p>Proportion of newborns with female sex (100/205)</p></li>
</ul></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="convenient-way-to-get-fso-data">Convenient way to get FSO data<a class="anchor" aria-label="anchor" href="#convenient-way-to-get-fso-data"></a>
</h2>
<p>The <code>propop</code> package provides two convenience functions to
download data from the FSO.</p>
<p>To get the starting population for a spatial unit, you must use the
spelling defined in the corresponding FSO table. The entries in the FSO
tables may contain special characters. The spelling may also vary
between FSO tables.</p>
<p><code><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_metadata.html" class="external-link">BFS::bfs_get_metadata()</a></code> is helpful to identify the
required spelling(s) (see further down on this page).</p>
<p>Here’s an example of how to get the population for the canton of
Aargau:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://statistik-aargau.github.io/propop">propop</a></span><span class="op">)</span> </span>
<span><span class="va">ag_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_population.html">get_population</a></span><span class="op">(</span></span>
<span>  number_fso <span class="op">=</span> <span class="st">"px-x-0102010000_101"</span>,</span>
<span>  year_first <span class="op">=</span> <span class="fl">2022</span>,</span>
<span>  year_last <span class="op">=</span> <span class="fl">2022</span>,</span>
<span>  spatial_units <span class="op">=</span> <span class="st">"- Aargau"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Get the parameters for a sample canton (mind using the same spelling
as in the FSO tables; see comment above):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ag_parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_parameters.html">get_parameters</a></span><span class="op">(</span></span>
<span>  year_first <span class="op">=</span> <span class="fl">2023</span>,</span>
<span>  year_last <span class="op">=</span> <span class="fl">2026</span>,</span>
<span>  spatial_units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aargau"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The projection can be run as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select reference scenario</span></span>
<span><span class="va">ag_parameters_ref</span> <span class="op">&lt;-</span> <span class="va">ag_parameters</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scen</span> <span class="op">==</span> <span class="st">"reference"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/propop.html">propop</a></span><span class="op">(</span></span>
<span>  parameters <span class="op">=</span> <span class="va">ag_parameters_ref</span>,</span>
<span>  year_first <span class="op">=</span> <span class="fl">2023</span>,</span>
<span>  year_last <span class="op">=</span> <span class="fl">2026</span>,</span>
<span>  age_groups <span class="op">=</span> <span class="fl">101</span>,</span>
<span>  fert_first <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  fert_last <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  share_born_female <span class="op">=</span> <span class="fl">100</span> <span class="op">/</span> <span class="fl">205</span>,</span>
<span>  population <span class="op">=</span> <span class="va">ag_population</span>,</span>
<span>  subregional <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Note of caution:</strong> As long as the FSO’s API interface
and the underlying data structure remain stable, the functions will
work. However, changes in the API are likely to break the functions.</p>
</div>
<div class="section level2">
<h2 id="manual-way-to-get-fso-data">Manual way to get FSO data<a class="anchor" aria-label="anchor" href="#manual-way-to-get-fso-data"></a>
</h2>
<p>In case the above shouldn’t work or if you want to retrace the
necessary steps manually, we also provide a step-by-step description of
how to get the population data and the projection parameters from the
FSO.</p>
</div>
<div class="section level2">
<h2 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h2>
<p>To download the data, we need the following packages:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://felixluginbuhl.com/BFS/" class="external-link">BFS</a></span><span class="op">)</span> <span class="co"># to download FSO data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># to process data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span> <span class="co"># to wrangle data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://statistik-aargau.github.io/propop">propop</a></span><span class="op">)</span> <span class="co"># to run population projection</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-queries-and-download-data">Prepare queries and download data<a class="anchor" aria-label="anchor" href="#prepare-queries-and-download-data"></a>
</h2>
<p>To make the data download faster, save disk space, and avoid
filtering after the download, it is advisable to specify and download
only the information that we really need. To prepare such a customised,
reduced data download, the <a href="https://felixluginbuhl.com/BFS/#query-specific-elements" class="external-link">instructions</a>
from the <code>BFS</code> package are very helpful.</p>
<p>Following these instructions, we can use the <code>text</code> and
<code>valueTexts</code> variables to generate a <strong>query</strong>
dimension object for each table and to <strong>download</strong> the
data (see following subsections). To illustrate, for table
<code>px-x-0104020000_101</code>, we can obtain the meta data as
follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_metadata.html" class="external-link">bfs_get_metadata</a></span><span class="op">(</span>number_bfs <span class="op">=</span> <span class="st">"px-x-0104020000_101"</span><span class="op">)</span></span>
<span><span class="va">metadata_tidy</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    valueTexts <span class="op">=</span> <span class="va">metadata</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">text</span>, <span class="va">values</span>, <span class="va">valueTexts</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata_tidy</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   code   text   values valueTexts   elimination title                           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Kanton Kanton 0      Schweiz      TRUE        Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Kanton Kanton 1      Zürich       TRUE        Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Kanton Kanton 2      Bern / Berne TRUE        Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Kanton Kanton 3      Luzern       TRUE        Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Kanton Kanton 4      Uri          TRUE        Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Kanton Kanton 5      Schwyz       TRUE        Szenarien zur Bevölkerungsentwi…</span></span></code></pre></div>
<p>Although the structure of the first three tables should be identical,
the low growth scenario (<code>_103</code>) contains different meta
information and requires some changes.</p>
<div class="section level3">
<h3 id="get-number-of-people-parameters">Get “number of people” parameters<a class="anchor" aria-label="anchor" href="#get-number-of-people-parameters"></a>
</h3>
<p>Some of FSO’s expectations are expressed in “number of people”
parameters (first three entries in the table). These parameters indicate
FSO expectations about how many people do certain things (e.g., how many
64-year old Swiss men will emigrate to another country in 2043).</p>
<p>To prepare the download of these parameters, we can specify the
following query:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify the elements to download</span></span>
<span><span class="va">dim1</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Kanton"</span> <span class="op">&amp;</span> <span class="co"># Canton</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aargau"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dim2</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Geschlecht"</span> <span class="op">&amp;</span> <span class="co"># sex</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Mann"</span>, <span class="co"># male</span></span>
<span>        <span class="st">"Frau"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># female</span></span>
<span></span>
<span><span class="va">dim3</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Alter"</span> <span class="op">&amp;</span> <span class="co"># get each age group</span></span>
<span>      <span class="op">!</span><span class="op">(</span><span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Alter - Total"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># but exclude "Total"</span></span>
<span></span>
<span><span class="va">dim4</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">text</span> <span class="op">==</span> <span class="st">"Jahr"</span><span class="op">)</span> <span class="co"># get all years</span></span>
<span></span>
<span><span class="co"># adapt to the different structure of the "low" scenario table</span></span>
<span><span class="va">dim4_103</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Jahr"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># get all years</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">31</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dim5</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Staatsangehörigkeit (Kategorie)"</span> <span class="op">&amp;</span> <span class="co"># nationality</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Schweiz"</span>, <span class="co"># Swiss</span></span>
<span>        <span class="st">"Ausland"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># Foreign / international</span></span>
<span></span>
<span><span class="va">dim6</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Beobachtungseinheit"</span> <span class="op">&amp;</span> <span class="co"># parameters for projection</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Einwanderungen"</span>, <span class="co"># international immigration</span></span>
<span>        <span class="st">"Auswanderungen"</span>, <span class="co"># international emigration</span></span>
<span>        <span class="st">"Interkantonale Zuwanderungen"</span>, <span class="co"># inter-cantonal immigration</span></span>
<span>        <span class="st">"Interkantonale Abwanderungen"</span> <span class="co"># inter-cantonal emigration</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># build dimensions list object</span></span>
<span><span class="va">dimensions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">dim1</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim2</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim3</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim4</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim5</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim6</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># add names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dimensions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim1</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim2</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim3</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim4</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim5</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim6</span><span class="op">$</span><span class="va">code</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># version for _103</span></span>
<span><span class="co"># build dimensions list object</span></span>
<span><span class="va">dimensions_103</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">dim1</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim2</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim3</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim4_103</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim5</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim6</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dimensions_103</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim1</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim2</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim3</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim4_103</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim5</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim6</span><span class="op">$</span><span class="va">code</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Using the above specifications, we can <strong>download</strong> the
FSO “number of people” parameters as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reference scenario</span></span>
<span><span class="va">fso_numbers_r</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_data.html" class="external-link">bfs_get_data</a></span><span class="op">(</span></span>
<span>  number_bfs <span class="op">=</span> <span class="st">"px-x-0104020000_101"</span>,</span>
<span>  query <span class="op">=</span> <span class="va">dimensions</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"Szenarien zur Bevölkerungsentwicklung der Kantone 2020-2050,"</span>,</span>
<span>    <span class="st">" Referenzszenario AR-00-2020 - zukünftige Bevölkerungsentwicklung"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scen <span class="op">=</span> <span class="st">"reference"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># high growth scenario</span></span>
<span><span class="va">fso_numbers_h</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_data.html" class="external-link">bfs_get_data</a></span><span class="op">(</span></span>
<span>  number_bfs <span class="op">=</span> <span class="st">"px-x-0104020000_102"</span>,</span>
<span>  query <span class="op">=</span> <span class="va">dimensions</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"Szenarien zur Bevölkerungsentwicklung der Kantone 2020-2050,"</span>,</span>
<span>    <span class="st">" 'hohes' Szenario BR-00-2020 - zukünftige Bevölkerungsentwicklung"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scen <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># low growth scenario</span></span>
<span><span class="va">fso_numbers_l</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_data.html" class="external-link">bfs_get_data</a></span><span class="op">(</span></span>
<span>  number_bfs <span class="op">=</span> <span class="st">"px-x-0104020000_103"</span>,</span>
<span>  query <span class="op">=</span> <span class="va">dimensions_103</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"Szenarien zur Bevölkerungsentwicklung der Kantone 2020-2050,"</span>,</span>
<span>    <span class="st">" 'tiefes' Szenario CR-00-2020 - zukünftige Bevölkerungsentwicklung"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scen <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine into a single data frame</span></span>
<span><span class="va">fso_numbers_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">fso_numbers_r</span>, <span class="va">fso_numbers_h</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">fso_numbers_l</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-rates-and-probabilities">Get “rates” and “probabilities”<a class="anchor" aria-label="anchor" href="#get-rates-and-probabilities"></a>
</h3>
<p>The FSO indicates some of its expectations as “rates” or
“probabilities” (row four in the overview table at the top). To
illustrate, these parameters could indicate the likelihood of 24-year
old Swiss women to have a child in the year 2034.</p>
<p>Before we can download the data, we again need the metadata:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_metadata.html" class="external-link">bfs_get_metadata</a></span><span class="op">(</span>number_bfs <span class="op">=</span> <span class="st">"px-x-0104020000_109"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata_tidy</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    valueTexts <span class="op">=</span> <span class="va">metadata</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">text</span>, <span class="va">values</span>, <span class="va">valueTexts</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">metadata_tidy</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt;   code   text   values valueTexts   elimination title                           </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Kanton Kanton 0      Zürich       <span style="color: #BB0000;">NA</span>          Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Kanton Kanton 1      Bern / Berne <span style="color: #BB0000;">NA</span>          Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Kanton Kanton 2      Luzern       <span style="color: #BB0000;">NA</span>          Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Kanton Kanton 3      Uri          <span style="color: #BB0000;">NA</span>          Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Kanton Kanton 4      Schwyz       <span style="color: #BB0000;">NA</span>          Szenarien zur Bevölkerungsentwi…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Kanton Kanton 5      Obwalden     <span style="color: #BB0000;">NA</span>          Szenarien zur Bevölkerungsentwi…</span></span></code></pre></div>
<p>To <strong>download</strong> the “rate” and “probability” parameters
(last row in the table), we can use the following specifications:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify the elements to download</span></span>
<span><span class="va">dim1</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Kanton"</span> <span class="op">&amp;</span> <span class="co"># Canton</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aargau"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dim2</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Szenario-Variante"</span> <span class="op">&amp;</span> <span class="co"># sex</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Referenzszenario AR-00-2020"</span>, <span class="co"># reference scenario</span></span>
<span>        <span class="st">"'hohes' Szenario BR-00-2020"</span>, <span class="co"># high growth</span></span>
<span>        <span class="st">"'tiefes' Szenario CR-00-2020"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># low growth</span></span>
<span></span>
<span><span class="va">dim3</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Staatsangehörigkeit (Kategorie)"</span> <span class="op">&amp;</span> <span class="co"># nationality</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Schweiz"</span>, <span class="co"># Swiss</span></span>
<span>        <span class="st">"Ausland"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># Foreign / international</span></span>
<span></span>
<span><span class="va">dim4</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Geschlecht"</span> <span class="op">&amp;</span> <span class="co"># sex</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Mann"</span>, <span class="co"># male</span></span>
<span>        <span class="st">"Frau"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># female</span></span>
<span></span>
<span><span class="va">dim5</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Alter"</span> <span class="op">&amp;</span> <span class="co"># all 1-year age groups</span></span>
<span>      <span class="op">!</span><span class="op">(</span><span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Alter - Total"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># but exclude "Total"</span></span>
<span></span>
<span><span class="va">dim6</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Jahr"</span></span>
<span>  <span class="op">)</span> <span class="co"># get all years</span></span>
<span></span>
<span><span class="va">dim7</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Beobachtungseinheit"</span> <span class="op">&amp;</span> <span class="co"># type of parameter types</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Geburtenziffern"</span>, <span class="co"># births</span></span>
<span>        <span class="st">"Prospektive Sterbewahrscheinlichkeiten"</span>, <span class="co"># mortality</span></span>
<span>        <span class="st">"Auswanderungsziffern"</span>, <span class="co"># international emigration</span></span>
<span>        <span class="st">"Interkantonale Abwanderungsziffern"</span>, <span class="co"># inter-cantonal emigration</span></span>
<span>        <span class="st">"Einbürgerungsziffern"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># acquisition of Swiss citizenship</span></span>
<span></span>
<span><span class="co"># build dimensions list object</span></span>
<span><span class="va">dimensions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">dim1</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim2</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim3</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim4</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim5</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim6</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim7</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># add names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dimensions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim1</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim2</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim3</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim4</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim5</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim6</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim7</span><span class="op">$</span><span class="va">code</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Using the above specifications, we can download the FSO “rate”
parameters as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download rate parameters</span></span>
<span><span class="va">fso_rates_raw</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_data.html" class="external-link">bfs_get_data</a></span><span class="op">(</span></span>
<span>  number_bfs <span class="op">=</span> <span class="st">"px-x-0104020000_109"</span>,</span>
<span>  query <span class="op">=</span> <span class="va">dimensions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We need to process the data to ensure that the structure of the rate
parameters conforms to the expectations of the projection function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bring variable names and factor levels into the format required later</span></span>
<span><span class="va">fso_rates</span> <span class="op">&lt;-</span> <span class="va">fso_rates_raw</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    nat <span class="op">=</span> <span class="st">"Staatsangehörigkeit (Kategorie)"</span>,</span>
<span>    sex <span class="op">=</span> <span class="va">Geschlecht</span>,</span>
<span>    age <span class="op">=</span> <span class="va">Alter</span>,</span>
<span>    year <span class="op">=</span> <span class="va">Jahr</span>,</span>
<span>    fso_parameter <span class="op">=</span> <span class="va">Beobachtungseinheit</span>,</span>
<span>    scen <span class="op">=</span> <span class="st">"Szenario-Variante"</span>,</span>
<span>    value <span class="op">=</span></span>
<span>      <span class="st">"Szenarien zur Bevölkerungsentwicklung der Kantone 2020-2050 - Ziffern"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># change factor levels</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scen <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">scen</span>,</span>
<span>      <span class="st">"Referenzszenario AR-00-2020"</span> <span class="op">~</span> <span class="st">"reference"</span>,</span>
<span>      <span class="st">"'hohes' Szenario BR-00-2020"</span> <span class="op">~</span> <span class="st">"high"</span>,</span>
<span>      <span class="st">"'tiefes' Szenario CR-00-2020"</span> <span class="op">~</span> <span class="st">"low"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    nat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">nat</span>,</span>
<span>      <span class="st">"Schweiz"</span> <span class="op">~</span> <span class="st">"ch"</span>,</span>
<span>      <span class="st">"Ausland"</span> <span class="op">~</span> <span class="st">"int"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">sex</span> <span class="op">==</span> <span class="st">"Mann"</span> <span class="op">~</span> <span class="st">"m"</span>,</span>
<span>      <span class="va">sex</span> <span class="op">==</span> <span class="st">"Frau"</span> <span class="op">~</span> <span class="st">"f"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">age</span>, <span class="st">"\\d+"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    fso_parameter <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">fso_parameter</span>,</span>
<span>      <span class="st">"Prospektive Sterbewahrscheinlichkeiten"</span> <span class="op">~</span> <span class="st">"mor"</span>,</span>
<span>      <span class="st">"Auswanderungsziffern"</span> <span class="op">~</span> <span class="st">"emi"</span>,</span>
<span>      <span class="st">"Interkantonale Abwanderungsziffern"</span> <span class="op">~</span> <span class="st">"intercant"</span>,</span>
<span>      <span class="st">"Einbürgerungsziffern"</span> <span class="op">~</span> <span class="st">"acq"</span>,</span>
<span>      <span class="st">"Geburtenziffern"</span> <span class="op">~</span> <span class="st">"birth_rate"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get-share-of-newborns-with-swiss-nationality-born-to-non-swiss-mothers">Get share of newborns with Swiss nationality born to non-Swiss
mothers<a class="anchor" aria-label="anchor" href="#get-share-of-newborns-with-swiss-nationality-born-to-non-swiss-mothers"></a>
</h3>
<p>Mothers who do not have Swiss citizenship may have a Swiss partner.
Their children will be Swiss nationals. To use this information in the
projection, we need to download another table and compute the
corresponding parameter.</p>
<p>Before we can download the data, we again need the metadata:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get meta data to determine what to download</span></span>
<span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_metadata.html" class="external-link">bfs_get_metadata</a></span><span class="op">(</span>number_bfs <span class="op">=</span> <span class="st">"px-x-0104020000_106"</span><span class="op">)</span></span>
<span><span class="va">metadata_tidy</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    valueTexts <span class="op">=</span> <span class="va">metadata</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">text</span>, <span class="va">values</span>, <span class="va">valueTexts</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To <strong>download</strong> the “rate” and “probability” parameters
(last row in the table), we can use the following specifications:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify the elements to download</span></span>
<span><span class="va">dim1</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Kanton"</span> <span class="op">&amp;</span> <span class="co"># Canton</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aargau"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dim2</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Szenario-Variante"</span> <span class="op">&amp;</span> <span class="co"># scenario</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"Referenzszenario AR-00-2020"</span>,</span>
<span>        <span class="st">"'hohes' Szenario BR-00-2020"</span>,</span>
<span>        <span class="st">"'tiefes' Szenario CR-00-2020"</span></span>
<span>      <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">dim3</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Staatsangehörigkeit (Kategorie)"</span> <span class="op">&amp;</span> <span class="co"># nationality</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Ausland"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">dim4</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Geschlecht"</span> <span class="op">&amp;</span> <span class="co"># sex</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Geschlecht - Total"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">dim5</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Altersklasse"</span> <span class="op">&amp;</span> <span class="co"># age</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Altersklasse - Total"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">dim6</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Jahr"</span></span>
<span>  <span class="op">)</span> <span class="co"># get all years</span></span>
<span><span class="va">dim7</span> <span class="op">&lt;-</span> <span class="va">metadata_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Beobachtungseinheit"</span> <span class="op">&amp;</span> <span class="co"># type of parameter types</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>          <span class="co"># live births of international newborns to international mothers</span></span>
<span>          <span class="st">"Lebendgeburten"</span>,</span>
<span>          <span class="st">"Lebendgeburten nach Alter und Staatsangehörigkeit der Mutter"</span></span>
<span>        <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># all live newborns to international mothers</span></span>
<span></span>
<span><span class="co"># build dimensions list object</span></span>
<span><span class="va">dimensions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">dim1</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim2</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim3</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim4</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim5</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim6</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim7</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dimensions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim1</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim2</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim3</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim4</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim5</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim6</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim7</span><span class="op">$</span><span class="va">code</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Using the above specifications, we can download the parameter as
follows:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download rate parameters</span></span>
<span><span class="va">fso_births_int_ch_raw</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_data.html" class="external-link">bfs_get_data</a></span><span class="op">(</span></span>
<span>  number_bfs <span class="op">=</span> <span class="st">"px-x-0104020000_106"</span>,</span>
<span>  query <span class="op">=</span> <span class="va">dimensions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We need to process the data to ensure that the structure of the
parameter conforms to the expectations of the projection function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bring variable names and factor levels into the format required later</span></span>
<span><span class="co"># Process data</span></span>
<span><span class="va">fso_births_int_ch</span> <span class="op">&lt;-</span> <span class="va">fso_births_int_ch_raw</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Compute share of Swiss newborns to international mothers</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">Beobachtungseinheit</span>,</span>
<span>    values_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Szenarien zur Bevölkerungsentwicklung der Kantone 2020-2050"</span>,</span>
<span>      <span class="st">" - zukünftige Bevölkerungsentwicklung"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># use shorter, clearer names</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    <span class="co"># all live births from international mothers</span></span>
<span>    live_birth_total <span class="op">=</span></span>
<span>      <span class="st">"Lebendgeburten nach Alter und Staatsangehörigkeit der Mutter"</span>,</span>
<span>    <span class="co"># live births of international newborns to international mothers</span></span>
<span>    live_birth_int <span class="op">=</span> <span class="va">Lebendgeburten</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    births_int_ch <span class="op">=</span> <span class="op">(</span><span class="va">live_birth_total</span> <span class="op">-</span> <span class="va">live_birth_int</span><span class="op">)</span> <span class="op">/</span> <span class="va">live_birth_total</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># Bring variable names and factor levels into the format required later</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    scen <span class="op">=</span> <span class="st">"Szenario-Variante"</span>,</span>
<span>    age <span class="op">=</span> <span class="va">Altersklasse</span>,</span>
<span>    year <span class="op">=</span> <span class="va">Jahr</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># change factor levels</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    scen <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">scen</span>,</span>
<span>      <span class="st">"Referenzszenario AR-00-2020"</span> <span class="op">~</span> <span class="st">"reference"</span>,</span>
<span>      <span class="st">"'hohes' Szenario BR-00-2020"</span> <span class="op">~</span> <span class="st">"high"</span>,</span>
<span>      <span class="st">"'tiefes' Szenario CR-00-2020"</span> <span class="op">~</span> <span class="st">"low"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># remove unnecessary variables</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">scen</span>, <span class="va">births_int_ch</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">scen</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="all-fso-parameters">All FSO parameters<a class="anchor" aria-label="anchor" href="#all-fso-parameters"></a>
</h3>
<p>Now we can merge “number of people” and “rate” parameters, make the
data frame wider, and compute the required parameter
<code>inter-cantonal net migration</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">projection_parameters</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">fso_rates</span>, <span class="va">fso_numbers</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">fso_parameter</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># compute inter-cantonal net migration</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mig_ch <span class="op">=</span> <span class="va">interc_imm</span> <span class="op">-</span> <span class="va">interc_emi</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">fso_births_int_ch</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"scen"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># add mandatory column spatial_unit</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>spatial_unit <span class="op">=</span> <span class="st">"Aargau"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># remove unnecessary variables</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Kanton</span>, <span class="va">intercant</span>, <span class="va">emi_n</span>, <span class="va">interc_imm</span>, <span class="va">interc_emi</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span></span></code></pre></div>
<p>Show parameters for one demographic group for the year 2024:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">projection_parameters</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2024</span> <span class="op">&amp;</span> <span class="va">sex</span> <span class="op">==</span> <span class="st">"f"</span> <span class="op">&amp;</span> <span class="va">nat</span> <span class="op">==</span> <span class="st">"int"</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-21c0cdfdf8cdffe5d0e3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-21c0cdfdf8cdffe5d0e3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3"],["reference","high","low"],["int","int","int"],["f","f","f"],[0,0,0],["2024","2024","2024"],[0,0,0],[0.004496,0.003419,0.004682],[0.008945,0.007692,0.011236],[0.010733,0.011111,0.001873],[17,24,16],[-4,-2,-2],[0.2349799732977303,0.2350127551020408,0.2348008385744235],["Aargau","Aargau","Aargau"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>scen<\/th>\n      <th>nat<\/th>\n      <th>sex<\/th>\n      <th>age<\/th>\n      <th>year<\/th>\n      <th>birth_rate<\/th>\n      <th>mor<\/th>\n      <th>emi<\/th>\n      <th>acq<\/th>\n      <th>imm_int<\/th>\n      <th>mig_ch<\/th>\n      <th>births_int_ch<\/th>\n      <th>spatial_unit<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[4,6,7,8,9,10,11,12]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="population">Population<a class="anchor" aria-label="anchor" href="#population"></a>
</h3>
<p>In addition to the parameters, the projection function
<code>propop</code> also requires a starting population. To prepare the
corresponding query, we again start with the metadata:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_pop</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_metadata.html" class="external-link">bfs_get_metadata</a></span><span class="op">(</span>number_bfs <span class="op">=</span> <span class="st">"px-x-0102010000_101"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">metadata_pop_tidy</span> <span class="op">&lt;-</span> <span class="va">metadata_pop</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">values</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    valueTexts <span class="op">=</span> <span class="va">metadata_pop</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">valueTexts</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">code</span>, <span class="va">text</span>, <span class="va">values</span>, <span class="va">valueTexts</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We can now specify which levels of the variables we want:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Specify the elements to download</span></span>
<span><span class="va">dim1</span> <span class="op">&lt;-</span> <span class="va">metadata_pop_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Kanton (-) / Bezirk (&gt;&gt;) / Gemeinde (......)"</span> <span class="op">&amp;</span> <span class="co"># Canton</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"- Aargau"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dim2</span> <span class="op">&lt;-</span> <span class="va">metadata_pop_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Jahr"</span> <span class="op">&amp;</span> <span class="co"># year</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2018"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dim3</span> <span class="op">&lt;-</span> <span class="va">metadata_pop_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Bevölkerungstyp"</span> <span class="op">&amp;</span> <span class="co"># permanent</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Ständige Wohnbevölkerung"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dim4</span> <span class="op">&lt;-</span> <span class="va">metadata_pop_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Staatsangehörigkeit (Kategorie)"</span> <span class="op">&amp;</span> <span class="co"># nationality</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Schweiz"</span>, <span class="st">"Ausland"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dim5</span> <span class="op">&lt;-</span> <span class="va">metadata_pop_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Geschlecht"</span> <span class="op">&amp;</span> <span class="co"># sex</span></span>
<span>      <span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Mann"</span>, <span class="st">"Frau"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">dim6</span> <span class="op">&lt;-</span> <span class="va">metadata_pop_tidy</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">text</span> <span class="op">==</span> <span class="st">"Alter"</span> <span class="op">&amp;</span> <span class="co"># age</span></span>
<span>      <span class="op">!</span><span class="op">(</span><span class="va">valueTexts</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Alter - Total"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="co"># exclude "Total"</span></span>
<span></span>
<span><span class="co"># build dimensions list object</span></span>
<span><span class="va">dimensions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">dim1</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim2</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim3</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim4</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim5</span><span class="op">$</span><span class="va">values</span>,</span>
<span>  <span class="va">dim6</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># add names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">dimensions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim1</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim2</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim3</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim4</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim5</span><span class="op">$</span><span class="va">code</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">dim6</span><span class="op">$</span><span class="va">code</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Using the above specifications, we can <strong>download</strong> the
FSO “population” as follows:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download population</span></span>
<span><span class="va">fso_pop_raw</span> <span class="op">&lt;-</span> <span class="fu">BFS</span><span class="fu">::</span><span class="fu"><a href="https://felixluginbuhl.com/BFS/reference/bfs_get_data.html" class="external-link">bfs_get_data</a></span><span class="op">(</span></span>
<span>  number_bfs <span class="op">=</span> <span class="st">"px-x-0102010000_101"</span>, <span class="co"># reference scenario</span></span>
<span>  query <span class="op">=</span> <span class="va">dimensions</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We now process the data to ensure that the population data conforms
to the structure expected in <code><a href="../reference/propop.html">propop::propop()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bring variable names and factor levels into the format required later</span></span>
<span><span class="va">starting_population</span> <span class="op">&lt;-</span> <span class="va">fso_pop_raw</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="st">"Bevölkerungstyp"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    year <span class="op">=</span> <span class="va">Jahr</span>,</span>
<span>    Kanton <span class="op">=</span> <span class="st">"Kanton (-) / Bezirk (&gt;&gt;) / Gemeinde (......)"</span>,</span>
<span>    nat <span class="op">=</span> <span class="st">"Staatsangehörigkeit (Kategorie)"</span>,</span>
<span>    sex <span class="op">=</span> <span class="va">Geschlecht</span>,</span>
<span>    age <span class="op">=</span> <span class="va">Alter</span>,</span>
<span>    n <span class="op">=</span> <span class="st">"Ständige und nichtständige Wohnbevölkerung"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># change factor levels</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    Kanton <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="va">Kanton</span>, <span class="st">"- "</span><span class="op">)</span>,</span>
<span>    nat <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span></span>
<span>      <span class="va">nat</span>,</span>
<span>      <span class="st">"Schweiz"</span> <span class="op">~</span> <span class="st">"ch"</span>,</span>
<span>      <span class="st">"Ausland"</span> <span class="op">~</span> <span class="st">"int"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sex <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">sex</span> <span class="op">==</span> <span class="st">"Mann"</span> <span class="op">~</span> <span class="st">"m"</span>,</span>
<span>      <span class="va">sex</span> <span class="op">==</span> <span class="st">"Frau"</span> <span class="op">~</span> <span class="st">"f"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">age</span>, <span class="st">"\\d+"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>spatial_unit <span class="op">=</span> <span class="va">Kanton</span><span class="op">)</span></span>
<span></span>
<span><span class="va">starting_population</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-bde80529c90716907ee8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-bde80529c90716907ee8">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404"],["2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018","2018"],["Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau"],["ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","ch","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int","int"],["m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","m","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f","f"],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],[2506,2589,2568,2635,2710,2608,2569,2611,2634,2512,2564,2411,2514,2531,2559,2571,2535,2515,2799,2739,2837,2916,3020,2865,2920,3052,3125,3058,3060,3057,2963,2923,3031,2906,3099,3001,3037,3029,3026,2936,2847,2897,2747,2824,3066,3046,3219,3435,3595,3689,4001,4084,4124,4203,4275,4109,4096,3998,3761,3721,3611,3627,3472,3441,3256,3146,3053,2845,2876,2797,2824,2738,2709,2557,2439,2351,2111,1895,1533,1454,1476,1297,1181,1114,1080,875,828,704,594,485,407,293,229,170,115,95,65,32,17,18,9,2377,2472,2524,2497,2403,2395,2472,2386,2540,2392,2467,2313,2357,2295,2384,2384,2415,2454,2513,2620,2620,2777,2838,2872,2925,2859,3127,2998,3056,2961,3006,3000,2969,2923,2965,3026,3169,3173,2992,2969,2864,2960,3126,3008,3064,3091,3285,3601,3801,3859,4113,4133,4266,4285,4371,4302,4124,4088,4001,3832,3831,3832,3628,3538,3388,3292,3300,3050,3083,2996,2956,2888,2895,2795,2731,2650,2379,2166,1927,1881,1805,1695,1694,1524,1493,1348,1312,1154,1070,913,810,618,543,435,319,238,171,115,74,36,54,1025,1028,1138,1033,1043,1043,1104,1042,974,958,1018,934,910,959,881,858,829,777,830,822,909,912,981,992,1072,1265,1341,1424,1635,1678,1700,1780,1778,1884,1950,1936,2056,2041,1981,1858,1877,1850,1808,1721,1641,1610,1678,1585,1529,1572,1503,1576,1531,1574,1538,1383,1230,1182,1161,986,923,819,777,712,623,515,494,458,490,415,417,385,371,295,328,329,333,270,326,270,242,181,190,144,116,76,61,43,44,39,23,23,10,9,3,3,2,1,1,3,1,951,962,1026,987,989,961,994,911,1004,936,905,884,874,905,867,777,730,670,705,661,730,771,835,915,938,1086,1231,1357,1400,1448,1514,1607,1648,1730,1763,1711,1733,1730,1742,1617,1618,1511,1492,1506,1422,1370,1432,1338,1249,1292,1224,1220,1185,1116,1124,1033,921,865,900,771,687,609,585,567,528,444,422,392,385,375,392,299,308,245,276,229,265,244,253,247,205,184,138,139,102,97,67,65,47,35,30,26,19,10,11,12,3,5,2,0,2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>year<\/th>\n      <th>spatial_unit<\/th>\n      <th>nat<\/th>\n      <th>sex<\/th>\n      <th>age<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="run-population-projections">Run population projections<a class="anchor" aria-label="anchor" href="#run-population-projections"></a>
</h2>
<p>Now that the parameters and the starting population are available, we
can run the population projections (see vignette `run_projections` for
more details). The result is shown for one demographic group.<br></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># only keep reference scenario</span></span>
<span><span class="va">projection_parameters_ref</span> <span class="op">&lt;-</span> <span class="va">projection_parameters</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scen</span> <span class="op">==</span> <span class="st">"reference"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run propop with data from prepare vignette to make sure vignette is okay</span></span>
<span><span class="va">results_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/propop.html">propop</a></span><span class="op">(</span></span>
<span>  parameters <span class="op">=</span> <span class="va">projection_parameters_ref</span>,</span>
<span>  year_first <span class="op">=</span> <span class="fl">2019</span>,</span>
<span>  year_last <span class="op">=</span> <span class="fl">2030</span>,</span>
<span>  age_groups <span class="op">=</span> <span class="fl">101</span>,</span>
<span>  fert_first <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  fert_last <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  share_born_female <span class="op">=</span> <span class="fl">100</span> <span class="op">/</span> <span class="fl">205</span>,</span>
<span>  population <span class="op">=</span> <span class="va">starting_population</span>,</span>
<span>  subregional <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_clean</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># select demographic group</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"f"</span> <span class="op">&amp;</span> <span class="va">nat</span> <span class="op">==</span> <span class="st">"int"</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">==</span> <span class="fl">49</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">n</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%.0f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">datatable</a></span><span class="op">(</span>filter <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-74295f22244eea8c85a2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-74295f22244eea8c85a2">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0\" data-max=\"1\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;m&quot;,&quot;f&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;ch&quot;,&quot;int&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"integer\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"2018\" data-max=\"2030\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"factor\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\" disabled=\"\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"width: 100%; display: none;\">\n      <select multiple=\"multiple\" style=\"width: 100%;\" data-options=\"[&quot;Aargau&quot;]\"><\/select>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13"],[49,49,49,49,49,49,49,49,49,49,49,49,49],["f","f","f","f","f","f","f","f","f","f","f","f","f"],["int","int","int","int","int","int","int","int","int","int","int","int","int"],[2018,2019,2020,2021,2022,2023,2024,2025,2026,2027,2028,2029,2030],["Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau","Aargau"],["1292","1257","1348","1439","1400","1455","1541","1549","1583","1677","1697","1801","1828"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>age<\/th>\n      <th>sex<\/th>\n      <th>nat<\/th>\n      <th>year<\/th>\n      <th>spatial_unit<\/th>\n      <th>n<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":[],"jsHooks":[]}</script><p><br></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Norah Efosa, Adrian Gadient, Tina Cornioley, Jan Wunder, Niklas Haffert, Statistik Aargau.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  
</body>
</html>
