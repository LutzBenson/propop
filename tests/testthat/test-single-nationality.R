# Specific argument-data configurations for projections with 1 nation
# Separated from propop::propop tests for brevity & quicker error identification
# Tests with two nationalities are part of test-propop

options(cli.default_handler = function(...) { })


test_that("propop single nation projection", {

  skip_on_ci()

  # /////////////////////////////////////////////////////
  # 1 region & 1 nationality ----------------------------
  # /////////////////////////////////////////////////////

  ## Prepare FSO parameters ----

  ### Population = CH ----
  # # Run next lines to generate the subsequent data frame
  # fso_parameters |>
  #   dplyr::filter(year < 2023) |>
  #   # drop non-Swiss people
  #   dplyr::filter(nat != "int") |>
  #   # remove `nat`, `acq` and `births_int_ch` from `parameters`
  #   select(-c(nat, acq, births_int_ch)) |>
  #   constructive::construct()

  param_sub_F_binat_F_CH <- tibble::tibble(
    sex = rep(rep(c("m", "f"), 4), each = 101L),
    age = rep(seq(0, 100, by = 1), 8),
    year = rep(c("2019", "2020", "2021", "2022"), each = 202L),
    scen = rep("reference", 808L),
    birth_rate = rep(
      c(
        0, 0.00041, 0.000808, 0.001581, 0.003418, 0.006455, 0.010405, 0.016157,
        0.02364, 0.032479, 0.042954, 0.055049, 0.068632, 0.083007, 0.09798, 0.111332,
        0.121122, 0.125879, 0.122941, 0.112803, 0.097161, 0.078333, 0.05944, 0.042398,
        0.028719, 0.018692, 0.011733, 0.006989, 0.00429, 0.00227, 0.001286, 0.000606,
        0.000277, 0.000262, 0, 0.000402, 0.001594, 0.003124, 0.005644, 0.009778,
        0.014979, 0.022016, 0.030871, 0.041047, 0.053292, 0.066976, 0.082033,
        0.097347, 0.111297, 0.121859, 0.127219, 0.124628, 0.114793, 0.099225,
        0.080272, 0.060831, 0.04378, 0.029622, 0.019051, 0.011915, 0.007267, 0.004389,
        0.002279, 0.001281, 0.000636, 3e-04, 0.000274, 0, 0.000397, 0.001189,
        0.002761, 0.005022, 0.00896, 0.013801, 0.020963, 0.029268, 0.039515, 0.051712,
        0.065693, 0.080769, 0.096497, 0.111021, 0.122476, 0.128351, 0.126158,
        0.116707, 0.10117, 0.08209, 0.06249, 0.044715, 0.030386, 0.01985, 0.012292,
        0.007375, 0.004235, 0.002478, 0.001286, 0.000633, 0.000315, 0, 0.000388,
        0.001176, 0.002354, 0.004694, 0.008035, 0.012982, 0.019644, 0.02766, 0.037926,
        0.049931, 0.064107, 0.079709, 0.095634, 0.111239, 0.122953, 0.129317, 0.12837,
        0.118799, 0.103116, 0.083982, 0.063837, 0.045833, 0.03117, 0.020371, 0.012606,
        0.007653, 0.004295, 0.002573, 0.001531, 0.000636, 0.000313, 0.000312, 0
      ),
      rep(
        c(118L, 1L, 170L, 1L, 170L, 1L, 171L, 1L, 51L),
        c(1L, 33L, 1L, 32L, 1L, 31L, 1L, 32L, 1L)
      )
    ),
    mor = c(
      0.004386, 0.000791, 0.000383, 0.000386, 0, 0, 0, 0, 0, 0, 0, 0.000388,
      0.000412, 0.000395, 0.000392, 0.000388, 0.000386, 0.000391, 0.00079, 0.00071,
      0.000726, 0.000702, 0.000683, 0.000661, 0.000348, 0.000342, 0.000328,
      0.000321, 0.000327, 0.000327, 0.000327, 0.000336, 0.00034, 0.000328, 0.000341,
      0.000641, 0.000661, 0.000653, 0.000655, 0.000655, 0.000675, 0.001045,
      0.001028, 0.001083, 0.001406, 0.001297, 0.001632, 0.001545, 0.001739, 0.00194,
      0.002162, 0.002244, 0.002442, 0.002661, 0.002849, 0.003036, 0.003402,
      0.003659, 0.003999, 0.004515, 0.004835, 0.005534, 0.006061, 0.006621,
      0.007257, 0.00799, 0.008904, 0.009823, 0.010539, 0.011816, 0.012866, 0.014162,
      0.015699, 0.017346, 0.019547, 0.021726, 0.02424, 0.027456, 0.031118, 0.035202,
      0.039863, 0.046055, 0.052408, 0.059247, 0.067295, 0.076852, 0.086808,
      0.096618, 0.107955, 0.119529, 0.129763, 0.139877, 0.150427, 0.166302,
      0.188235, 0.217391, 0.252632, 0.292308, 0.3125, 0.352941, 0.481481, 0.003348,
      0.000417, 0.000401, 0.000393, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0.000404, 0.000395, 0.00038, 0.00038, 0.000359, 0.000351, 0.000348, 0.000342,
      0.000349, 0.00032, 0.000333, 0.000327, 0.000337, 0.000331, 0.000332, 0.000669,
      0.000679, 0.000669, 0.000656, 0.000626, 0.000625, 0.000662, 0.000668,
      0.000692, 0.00067, 0.000635, 0.00066, 0.000972, 0.000964, 0.000908, 0.001106,
      0.001311, 0.001291, 0.001455, 0.001689, 0.001871, 0.001863, 0.002055, 0.00232,
      0.002663, 0.002931, 0.003245, 0.003389, 0.003651, 0.004173, 0.004683,
      0.005088, 0.005315, 0.006073, 0.006359, 0.007207, 0.007778, 0.008338,
      0.009125, 0.010379, 0.011395, 0.012876, 0.014275, 0.016217, 0.018063,
      0.020766, 0.023334, 0.027092, 0.030437, 0.035367, 0.04072, 0.046557, 0.054235,
      0.063033, 0.073143, 0.084885, 0.098085, 0.112815, 0.12947, 0.147011, 0.167587,
      0.193103, 0.222571, 0.260504, 0.304094, 0.347826, 0.391892, 0.555556,
      0.004356, 0.000789, 0.000389, 0.000377, 0, 0, 0, 0, 0, 0, 0, 0.000392,
      0.000383, 0.000406, 0.000389, 0.000386, 0.000382, 0.00038, 0.000772, 0.00078,
      0.000702, 0.000719, 0.000696, 0.000679, 0.000659, 0.000348, 0.000343,
      0.000329, 0.000322, 0.000327, 0.000326, 0.000325, 0.000333, 0.000336,
      0.000324, 0.000672, 0.000631, 0.00065, 0.000642, 0.000644, 0.000968, 0.000997,
      0.001028, 0.001013, 0.001422, 0.001388, 0.001604, 0.001616, 0.001839,
      0.002015, 0.00193, 0.002153, 0.002238, 0.002437, 0.002656, 0.003083, 0.00327,
      0.003647, 0.00391, 0.004259, 0.004792, 0.00539, 0.005832, 0.006368, 0.00723,
      0.007597, 0.008678, 0.009308, 0.010573, 0.011348, 0.012647, 0.013746,
      0.015078, 0.017053, 0.018769, 0.02112, 0.023451, 0.026574, 0.030141, 0.034258,
      0.039136, 0.044317, 0.050355, 0.057724, 0.065618, 0.075, 0.084253, 0.095,
      0.105615, 0.116242, 0.127985, 0.136954, 0.148148, 0.165657, 0.184211,
      0.210145, 0.244444, 0.28169, 0.326087, 0.363636, 0.48, 0.003316, 0.000414,
      0.00041, 0.000395, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000402,
      0.000398, 0.00039, 0.000376, 0.000376, 0.000357, 0.000349, 0.000347, 0.000342,
      0.000348, 0.00032, 0.000332, 0.000651, 0.000334, 0.000657, 0.000657, 0.000661,
      0.000669, 0.000659, 0.000647, 0.000617, 0.000616, 0.000651, 0.000657,
      0.000681, 0.00066, 0.00094, 0.000976, 0.00096, 0.000953, 0.001199, 0.001371,
      0.001303, 0.001541, 0.00169, 0.001683, 0.001866, 0.002093, 0.00228, 0.00255,
      0.002904, 0.003176, 0.003497, 0.003655, 0.004181, 0.004446, 0.004979,
      0.005402, 0.005938, 0.006408, 0.006998, 0.007577, 0.008479, 0.009066,
      0.010216, 0.011171, 0.012565, 0.014118, 0.015953, 0.018001, 0.020508,
      0.023064, 0.026497, 0.029981, 0.034748, 0.039658, 0.046097, 0.053571,
      0.062257, 0.071965, 0.082957, 0.096454, 0.110709, 0.127082, 0.144068,
      0.164461, 0.190265, 0.219373, 0.254032, 0.295455, 0.344538, 0.4, 0.529412,
      0.004338, 0.000784, 0.000387, 0.000383, 0, 0, 0, 0, 0, 0, 0, 0.000371,
      0.000388, 0.000378, 4e-04, 0.000384, 0.00038, 0.000376, 0.000751, 0.000762,
      0.000771, 0.000696, 0.000713, 0.000692, 0.000339, 0.00033, 0.000348, 0.000344,
      0.000331, 0.000322, 0.000326, 0.000324, 0.000322, 0.000329, 0.000331,
      0.000639, 0.000661, 0.000622, 0.000639, 0.000631, 0.00095, 0.000954, 0.000983,
      0.001014, 0.001334, 0.001403, 0.001371, 0.00159, 0.001601, 0.001825, 0.002004,
      0.002197, 0.002144, 0.002481, 0.002675, 0.002893, 0.003082, 0.003505,
      0.003894, 0.004162, 0.004771, 0.005072, 0.005679, 0.006132, 0.006952,
      0.007565, 0.008247, 0.009063, 0.010037, 0.011009, 0.01218, 0.013509, 0.014657,
      0.016396, 0.018093, 0.020264, 0.022783, 0.025707, 0.029524, 0.033567,
      0.037693, 0.043478, 0.049291, 0.055949, 0.063821, 0.073077, 0.082121,
      0.091954, 0.10221, 0.113602, 0.124212, 0.133333, 0.144809, 0.160535, 0.180049,
      0.206452, 0.238532, 0.279412, 0.313725, 0.354839, 0.444444, 0.003302, 0.00041,
      0.000407, 0.000404, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000396,
      0.000394, 0.000386, 0.000373, 0.000373, 0.000355, 0.000348, 0.000347,
      0.000342, 0.000348, 0.00032, 0.00033, 0.000647, 0.000331, 0.00065, 0.00065,
      0.000652, 0.000329, 0.000649, 0.000637, 0.000608, 0.000608, 0.00064, 0.000647,
      0.00067, 0.000651, 0.000929, 0.000964, 0.000949, 0.001257, 0.001188, 0.001363,
      0.001556, 0.001533, 0.001685, 0.001918, 0.002095, 0.002321, 0.002505,
      0.002779, 0.002904, 0.003177, 0.003752, 0.003923, 0.004454, 0.004726,
      0.005284, 0.005718, 0.006265, 0.006745, 0.00765, 0.008285, 0.008866, 0.009816,
      0.010997, 0.012344, 0.013776, 0.015407, 0.017702, 0.019871, 0.022653, 0.02598,
      0.02934, 0.034222, 0.039481, 0.045685, 0.05214, 0.06087, 0.070863, 0.081702,
      0.09396, 0.10873, 0.124346, 0.142454, 0.163097, 0.18552, 0.215847, 0.251825,
      0.291892, 0.33871, 0.397436, 0.517647, 0.004312, 0.000782, 0.000385, 0.000381,
      0, 0, 0, 0, 0, 0, 0, 0.000371, 0.000367, 0.000383, 0.000373, 0.000394,
      0.000378, 0.000374, 0.000743, 0.000742, 0.000754, 0.000764, 0.000691,
      0.000709, 0.000345, 0.000339, 0.000331, 0.000349, 0.000344, 0.000331,
      0.000322, 0.000324, 0.000321, 0.000319, 0.000324, 0.000326, 0.00063, 0.00065,
      0.000612, 0.000629, 0.000932, 0.000937, 0.000941, 0.000971, 0.001334,
      0.001318, 0.001385, 0.001695, 0.001577, 0.001907, 0.002115, 0.001994,
      0.002189, 0.002404, 0.002724, 0.002915, 0.003131, 0.00332, 0.003741, 0.004142,
      0.004416, 0.005037, 0.005622, 0.005971, 0.006714, 0.007273, 0.008209,
      0.008906, 0.009764, 0.010781, 0.011794, 0.013041, 0.014404, 0.015979,
      0.017771, 0.01995, 0.022231, 0.025374, 0.028565, 0.032251, 0.036788, 0.042056,
      0.048316, 0.054923, 0.062426, 0.070902, 0.079876, 0.090549, 0.1, 0.110769,
      0.121417, 0.129231, 0.141058, 0.15655, 0.175649, 0.202381, 0.235772, 0.26506,
      0.306122, 0.342857, 0.457143, 0.003286, 0.000408, 0.000403, 4e-04, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000392, 0.000392, 0.000391, 0.000383,
      0.000371, 0.000371, 0.000355, 0.000348, 0.000347, 0.000343, 0.000347, 0.00032,
      0.000328, 0.000321, 0.000655, 0.000642, 0.000321, 0.000321, 0.000648,
      0.000638, 0.000628, 0.000599, 0.000599, 0.00063, 0.000638, 0.000661, 0.000964,
      0.000918, 0.000954, 0.00094, 0.001246, 0.001472, 0.001355, 0.00155, 0.00178,
      0.001919, 0.001914, 0.002092, 0.002317, 0.00273, 0.003009, 0.003145, 0.003669,
      0.00401, 0.004192, 0.004732, 0.005015, 0.00559, 0.006031, 0.006593, 0.007397,
      0.008009, 0.008675, 0.009595, 0.010929, 0.012149, 0.013554, 0.015387,
      0.017123, 0.019536, 0.022235, 0.025373, 0.029093, 0.033529, 0.038863, 0.04473,
      0.05181, 0.059701, 0.069364, 0.080227, 0.09255, 0.107548, 0.12178, 0.140397,
      0.159278, 0.183071, 0.211111, 0.247387, 0.287805, 0.335878, 0.390244,
      0.511364
    ),
    emi = c(
      0.002417, 0.005986, 0.005407, 0.005062, 0.004175, 0.004059, 0.003834,
      0.003114, 0.002681, 0.002278, 0.00199, 0.00156, 0.001244, 0.001193, 0.00079,
      0.000782, 0.000778, 0.000789, 0.001193, 0.001786, 0.002556, 0.003172,
      0.003429, 0.003974, 0.004538, 0.005137, 0.005242, 0.00544, 0.005559, 0.005556,
      0.005561, 0.0054, 0.005132, 0.005279, 0.004818, 0.00484, 0.004332, 0.004281,
      0.004292, 0.003966, 0.003747, 0.003512, 0.003452, 0.00364, 0.003541, 0.003262,
      0.003283, 0.003107, 0.002911, 0.002782, 0.002711, 0.002749, 0.002449,
      0.002425, 0.002617, 0.002807, 0.00292, 0.003174, 0.003252, 0.003457, 0.003494,
      0.0036, 0.003584, 0.003744, 0.003778, 0.004914, 0.003814, 0.002948, 0.002812,
      0.002434, 0.002145, 0.002125, 0.001826, 0.001846, 0.001564, 0.00164, 0.001276,
      0.000947, 0.001055, 0.000652, 0.000688, 0.000678, 0.000771, 0.000847, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.003384, 0.003786, 0.003641,
      0.003566, 0.003604, 0.003329, 0.00334, 0.003236, 0.003353, 0.002756, 0.002926,
      0.002432, 0.002162, 0.002121, 0.002179, 0.001678, 0.001678, 0.001656,
      0.002037, 0.003183, 0.003053, 0.003053, 0.003241, 0.004228, 0.004875,
      0.005812, 0.006296, 0.006716, 0.007005, 0.006872, 0.006417, 0.005988,
      0.005667, 0.004715, 0.004447, 0.00371, 0.003305, 0.00284, 0.002521, 0.002674,
      0.002358, 0.002444, 0.002365, 0.002239, 0.002327, 0.002285, 0.002265,
      0.002435, 0.002222, 0.002368, 0.002332, 0.002188, 0.002178, 0.00211, 0.0021,
      0.002059, 0.002092, 0.00194, 0.001957, 0.00175, 0.001827, 0.001827, 0.001827,
      0.001929, 0.002544, 0.002066, 0.002126, 0.001515, 0.001311, 0.001297,
      0.001335, 0.001015, 0.001039, 0.001036, 0.001073, 0.001098, 0.001132,
      0.001261, 0.000923, 0.001038, 0.000532, 0.000554, 0.00059, 0.00059, 0.000656,
      0.00067, 0.000742, 0.000762, 0.000867, 0.000935, 0.001095, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0.001999, 0.005976, 0.005488, 0.004941, 0.004599, 0.00412,
      0.003652, 0.003038, 0.002699, 0.00228, 0.001884, 0.001577, 0.001157, 0.000819,
      0.000785, 0.000778, 0.000769, 0.000766, 0.001166, 0.001962, 0.002472,
      0.003251, 0.003842, 0.004084, 0.004616, 0.005216, 0.005479, 0.005588,
      0.005782, 0.005566, 0.005554, 0.005543, 0.005353, 0.005076, 0.004892,
      0.004744, 0.004453, 0.004261, 0.004207, 0.003896, 0.003901, 0.003686,
      0.003801, 0.003403, 0.003584, 0.003145, 0.003227, 0.002924, 0.003079, 0.00289,
      0.003042, 0.002969, 0.002493, 0.002442, 0.00242, 0.002614, 0.002806, 0.002922,
      0.003179, 0.003259, 0.003465, 0.003507, 0.003336, 0.003601, 0.003475,
      0.004673, 0.00341, 0.00321, 0.002645, 0.002129, 0.002109, 0.00181, 0.001795,
      0.001854, 0.001502, 0.001594, 0.001257, 0.001307, 0.000973, 0.000544,
      0.000675, 0.000715, 0.00071, 0.000813, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0.00252, 0.003759, 0.003724, 0.00358, 0.003512, 0.003553,
      0.003287, 0.003302, 0.003203, 0.002905, 0.002729, 0.002482, 0.002407,
      0.002133, 0.002089, 0.001709, 0.001639, 0.001639, 0.002431, 0.002807,
      0.002749, 0.003023, 0.0034, 0.00429, 0.005252, 0.005901, 0.006496, 0.006974,
      0.007047, 0.006656, 0.006527, 0.006042, 0.005611, 0.005286, 0.004659,
      0.003709, 0.003322, 0.002934, 0.002489, 0.002484, 0.002298, 0.002318,
      0.002402, 0.002329, 0.002208, 0.002294, 0.002255, 0.002237, 0.002109,
      0.002203, 0.002093, 0.002061, 0.002179, 0.002169, 0.002104, 0.002096,
      0.002055, 0.001857, 0.001939, 0.001957, 0.00175, 0.001829, 0.001831, 0.001832,
      0.002489, 0.001989, 0.002079, 0.001527, 0.001218, 0.001319, 0.000979,
      0.001008, 0.001022, 0.001048, 0.001047, 0.001087, 0.001114, 0.001149,
      0.000855, 0.000942, 0.000531, 0.000546, 0.00057, 0.000611, 0.000615, 0.000687,
      0.000708, 0.000791, 0.000822, 0.000946, 0.001035, 0.001235, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0.002781, 0.006334, 0.005473, 0.005012, 0.004499, 0.004159, 0.003706,
      0.003256, 0.002635, 0.002294, 0.001885, 0.001494, 0.00117, 0.001142, 0.000807,
      0.000773, 0.000765, 0.000758, 0.001134, 0.001917, 0.002714, 0.003146, 0.00394,
      0.004161, 0.004744, 0.005268, 0.005561, 0.005834, 0.005943, 0.005801,
      0.005557, 0.00553, 0.005509, 0.005295, 0.005008, 0.004829, 0.004668, 0.004387,
      0.004191, 0.004136, 0.003833, 0.003523, 0.003632, 0.003744, 0.003357, 0.00318,
      0.003105, 0.002876, 0.002897, 0.00275, 0.002585, 0.002479, 0.002419, 0.002486,
      0.002437, 0.002415, 0.002612, 0.002808, 0.002925, 0.003186, 0.003268,
      0.003207, 0.003249, 0.003348, 0.003342, 0.004654, 0.003535, 0.003126,
      0.002592, 0.002003, 0.001792, 0.001778, 0.001833, 0.001822, 0.001508, 0.00153,
      0.001221, 0.000857, 0.000895, 0.001002, 0.000563, 0.000702, 0.000747,
      0.000746, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.003339,
      0.004132, 0.003695, 0.00366, 0.003527, 0.003466, 0.003123, 0.003249, 0.003267,
      0.002774, 0.002877, 0.002317, 0.002047, 0.001983, 0.002101, 0.002051,
      0.001669, 0.002001, 0.002404, 0.003189, 0.00317, 0.003107, 0.003747, 0.004493,
      0.005336, 0.00593, 0.006586, 0.006845, 0.006959, 0.007054, 0.006629, 0.006171,
      0.005657, 0.004904, 0.004253, 0.003612, 0.003322, 0.002944, 0.002571,
      0.002452, 0.002143, 0.00226, 0.002281, 0.002364, 0.002296, 0.002181, 0.002264,
      0.002228, 0.002212, 0.002089, 0.002188, 0.002081, 0.002051, 0.002171,
      0.001923, 0.001866, 0.00186, 0.001825, 0.001856, 0.001697, 0.001713, 0.001753,
      0.001832, 0.001836, 0.002362, 0.001946, 0.001716, 0.001493, 0.001227,
      0.001225, 0.000995, 0.000986, 0.001016, 0.001032, 0.001059, 0.00106, 0.001101,
      0.00113, 0.00078, 0.000872, 0.000963, 0.000544, 0.000561, 0.00059, 0.000635,
      0.000644, 0.000725, 0.000754, 0.000852, 0.000895, 0.001046, 0.001163, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0.002369, 0.006314, 0.005445, 0.004994, 0.004559, 0.004444,
      0.003734, 0.003304, 0.002872, 0.00224, 0.001893, 0.001493, 0.001108, 0.001157,
      0.000751, 0.000397, 0.000761, 0.000753, 0.001121, 0.001866, 0.002654,
      0.003452, 0.004161, 0.004266, 0.004831, 0.005415, 0.005939, 0.005921,
      0.005852, 0.005964, 0.005808, 0.005532, 0.005489, 0.005136, 0.004894,
      0.004934, 0.004442, 0.004262, 0.004012, 0.003805, 0.003757, 0.003775,
      0.003474, 0.003583, 0.003359, 0.003317, 0.003137, 0.00307, 0.002852, 0.002873,
      0.002731, 0.002572, 0.002743, 0.00241, 0.002481, 0.002677, 0.002654, 0.00285,
      0.00281, 0.002928, 0.003193, 0.003277, 0.003216, 0.00326, 0.003362, 0.004195,
      0.003226, 0.00297, 0.002207, 0.001961, 0.001686, 0.001812, 0.001801, 0.001487,
      0.001481, 0.001535, 0.001171, 0.000832, 0.000879, 0.000461, 0.000518,
      0.000584, 0.000733, 0.000785, 0.00079, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0.003317, 0.004119, 0.004065, 0.004031, 0.003606, 0.003484, 0.003429,
      0.00309, 0.003215, 0.002829, 0.002748, 0.002443, 0.002293, 0.00202, 0.001954,
      0.002062, 0.00201, 0.002034, 0.002348, 0.003153, 0.003152, 0.003141, 0.003843,
      0.004464, 0.005203, 0.006033, 0.006613, 0.006932, 0.007197, 0.006944,
      0.006729, 0.005931, 0.005484, 0.004939, 0.004199, 0.003878, 0.003236,
      0.002942, 0.002575, 0.002531, 0.002415, 0.002112, 0.002223, 0.002248,
      0.002329, 0.002265, 0.002155, 0.002238, 0.002204, 0.002192, 0.00207, 0.001904,
      0.002072, 0.002041, 0.001924, 0.001918, 0.001863, 0.001626, 0.001823,
      0.001623, 0.001696, 0.001714, 0.001756, 0.001836, 0.002103, 0.001847,
      0.001678, 0.001437, 0.0012, 0.001234, 0.001233, 0.001002, 0.000993, 0.001025,
      0.001042, 0.001071, 0.001074, 0.001117, 0.000767, 0.000795, 0.000891,
      0.000494, 0.000559, 0.00058, 0.000613, 0.000664, 0.000679, 0.000771, 0.000811,
      0.000926, 0.000987, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    ),
    imm_int = rep(
      rep(
        c(
          2, 15, 14, 13, 11, 10, 9, 8, 7, 6, 5, 4, 3, 4, 5, 6, 8, 9, 10, 12, 13, 14, 15,
          16, 15, 14, 13, 12, 11, 10, 11, 12, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1,
          0, 4, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 5, 6, 8, 11, 13, 14, 16, 17, 16, 15,
          13, 11, 10, 8, 7, 8, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0
        ),
        4
      ),
      rep(
        c(
          1L, 2L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 1L, 1L, 1L,
          1L, 1L, 1L, 5L, 1L, 1L, 2L, 2L, 2L, 2L, 3L, 1L, 1L, 2L, 2L, 1L, 3L, 3L, 3L,
          4L, 2L, 5L, 5L, 4L, 5L, 8L, 9L, 1L, 2L, 1L, 1L, 1L, 2L, 1L, 1L, 1L, 2L, 3L,
          1L, 2L, 1L, 1L, 1L, 1L, 2L, 2L, 1L, 1L, 2L, 1L, 1L, 2L, 2L, 7L, 6L, 4L, 6L,
          4L, 4L, 4L, 6L, 5L, 10L, 8L
        ),
        4
      )
    ),
    mig_ch = c(
      17, 34, 26, 23, 16, 10, 7, 6, 2, 1, 2, 0, 1, 0, 1, 1, 2, 4, 6, 5, 6, 7, 5, 1,
      0, -7, -18, -19, -13, -10, -5, 8, 11, 12, 17, 16, 19, 19, 18, 17, 17, 16, 14,
      15, 12, 9, 10, 8, 7, 6, 5, 3, 3, 3, 3, 3, 3, 2, 2, 4, 3, 5, 5, 6, 10, 3, 2, 4,
      4, 3, 2, 1, 2, 1, 1, 1, 0, 1, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1, -1, -1, 0, 0,
      -1, -1, 0, 0, 0, 0, 0, 0, 0, 27, 22, 23, 19, 16, 13, 11, 7, 7, 5, 7, 7, 9, 9,
      10, 11, 10, 8, 4, 0, -3, 0, -4, -5, -13, -19, -10, -21, -8, -6, 2, 6, 6, 14,
      16, 15, 12, 13, 13, 18, 16, 16, 14, 12, 12, 12, 12, 9, 8, 6, 7, 6, 6, 6, 5, 5,
      6, 5, 5, 4, 4, 3, 2, 4, 1, -3, 3, 4, 4, 4, 4, 4, 4, 2, 2, 2, 3, 3, 2, 3, 2, 3,
      2, 1, 2, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 16, 34, 28, 20, 16,
      11, 8, 6, 3, 1, 1, 1, 1, 1, 1, 2, 1, 2, 5, 6, 6, 7, 6, 2, -5, -8, -13, -21,
      -18, -7, -2, 2, 13, 15, 14, 19, 17, 20, 19, 17, 16, 16, 14, 12, 12, 10, 8, 8,
      7, 6, 5, 6, 2, 2, 4, 3, 2, 3, 2, 3, 5, 6, 7, 6, 11, 4, 3, 4, 4, 3, 3, 2, 1, 1,
      1, 1, 1, 0, 0, 0, 0, 0, 0, -1, 0, -1, -1, -1, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0,
      0, 0, 0, 33, 22, 24, 19, 15, 12, 11, 8, 6, 6, 6, 7, 8, 9, 10, 11, 10, 8, 4,
      -2, -2, -2, 0, -9, -10, -16, -20, -10, -16, -4, 0, 9, 11, 10, 16, 16, 16, 14,
      15, 12, 16, 15, 14, 12, 10, 10, 11, 10, 9, 7, 6, 7, 6, 5, 5, 5, 5, 6, 5, 5, 4,
      3, 2, 3, 1, -3, 3, 5, 4, 4, 3, 2, 2, 3, 2, 3, 3, 2, 3, 3, 3, 2, 2, 2, 2, 2, 1,
      1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 13, 32, 28, 22, 15, 13, 9, 5, 3, 2,
      2, 1, 1, 0, 1, 2, 2, 3, 4, 5, 7, 6, 7, 3, -6, -14, -13, -16, -19, -14, 0, 5,
      9, 19, 18, 19, 21, 18, 20, 18, 16, 14, 13, 11, 9, 11, 9, 6, 7, 6, 6, 4, 4, 3,
      2, 3, 3, 4, 5, 5, 5, 6, 7, 7, 11, 5, 3, 5, 4, 2, 2, 1, 2, 1, 1, 1, 1, 0, -1,
      -1, -1, 0, 0, -1, 0, -1, -1, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 27,
      22, 25, 20, 14, 10, 9, 8, 7, 5, 6, 7, 8, 9, 10, 10, 11, 8, 3, -3, -5, 0, -3,
      -2, -13, -15, -19, -19, -8, -10, 1, 6, 14, 16, 13, 18, 18, 17, 16, 15, 13, 16,
      13, 13, 11, 9, 9, 9, 8, 8, 6, 5, 7, 5, 5, 6, 6, 7, 6, 6, 6, 3, 4, 5, 0, -2, 2,
      5, 4, 3, 3, 3, 2, 3, 3, 2, 2, 2, 3, 3, 3, 2, 2, 2, 2, 1, 2, 1, 2, 1, 1, 1, 1,
      0, 0, 0, 0, 0, 0, 0, 0, 7, 35, 29, 22, 16, 11, 9, 6, 2, 2, 1, 1, 0, 1, 1, 1,
      2, 3, 4, 5, 6, 7, 5, 2, -5, -14, -20, -15, -13, -13, -5, 7, 14, 16, 22, 22,
      19, 22, 18, 18, 17, 15, 13, 11, 10, 9, 9, 8, 6, 6, 5, 5, 2, 3, 3, 3, 4, 4, 4,
      6, 5, 6, 7, 7, 12, 4, 4, 4, 5, 3, 2, 2, 1, 1, 1, 1, 1, 0, -1, -1, 0, 0, 0, -1,
      -1, -1, -1, 0, -1, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 27, 22, 25, 19, 16,
      11, 9, 7, 7, 6, 6, 8, 8, 9, 10, 11, 10, 8, 4, -5, -6, -5, 0, -6, -8, -17, -17,
      -18, -15, -3, -4, 8, 12, 15, 17, 15, 18, 18, 18, 16, 15, 12, 14, 12, 12, 9, 7,
      8, 7, 8, 7, 6, 4, 6, 6, 6, 6, 7, 6, 6, 6, 5, 4, 6, 1, -2, 3, 5, 5, 4, 2, 2, 2,
      2, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 1, 2, 1, 2, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
      0, 0
    ),
    spatial_unit = rep("Aargau", 808L),
  )


  ### Population = INT ----
  # # Run next lines to generate the subsequent data frame
  # fso_parameters |>
  #   dplyr::filter(year < 2023) |>
  #   # drop non-Swiss people
  #   dplyr::filter(nat == "int") |>
  #   # remove `nat`, `acq` and `births_int_ch` from `parameters`
  #   select(-c(nat, acq, births_int_ch)) |>
  #   constructive::construct()


  param_sub_F_binat_F_INT <- tibble::tibble(
    sex = rep(rep(c("m", "f"), 4), each = 101L),
    age = rep(seq(0, 100, by = 1), 8),
    year = rep(c("2019", "2020", "2021", "2022"), each = 202L),
    scen = rep("reference", 808L),
    birth_rate = rep(
      c(
        0, 0.001381, 0.005993, 0.017009, 0.032641, 0.048974, 0.065594, 0.081725,
        0.094398, 0.106007, 0.114386, 0.122848, 0.130621, 0.134582, 0.136562,
        0.134367, 0.129289, 0.120395, 0.109997, 0.096929, 0.083624, 0.06944, 0.055859,
        0.043528, 0.032069, 0.022818, 0.015167, 0.009358, 0.005302, 0.002804,
        0.001454, 0.000698, 0, 0.001327, 0.005602, 0.014993, 0.030641, 0.047519,
        0.063492, 0.078652, 0.093285, 0.104471, 0.114964, 0.123887, 0.130657,
        0.136027, 0.137455, 0.134702, 0.130354, 0.122096, 0.111176, 0.098619,
        0.085166, 0.071162, 0.057419, 0.044622, 0.033077, 0.023306, 0.015352,
        0.009823, 0.005317, 0.002639, 0.001394, 0.000722, 0, 0.001213, 0.004043,
        0.014075, 0.029283, 0.046235, 0.06246, 0.077519, 0.090401, 0.1034, 0.114556,
        0.124167, 0.13153, 0.136535, 0.13888, 0.136307, 0.131814, 0.123761, 0.112791,
        0.100402, 0.086159, 0.072137, 0.057938, 0.045147, 0.033561, 0.023864,
        0.015858, 0.009777, 0.005856, 0.002642, 0.001313, 0.000693, 0, 0.001173,
        0.003704, 0.012179, 0.027567, 0.044017, 0.060716, 0.075515, 0.089045,
        0.101429, 0.114237, 0.123859, 0.132359, 0.137179, 0.139701, 0.137783, 0.13289,
        0.125037, 0.114519, 0.101367, 0.087962, 0.073626, 0.059482, 0.046171,
        0.034202, 0.024328, 0.016426, 0.009706, 0.005473, 0.003231, 0.001312,
        0.000653, 0
      ),
      rep(
        c(118L, 1L, 171L, 1L, 171L, 1L, 171L, 1L, 53L),
        c(1L, 31L, 1L, 31L, 1L, 31L, 1L, 31L, 1L)
      )
    ),
    mor = c(
      0.003623, 0.000971, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.001172,
      0.001214, 0.001293, 0.001206, 0.001205, 0.001079, 0.001062, 0, 0, 0, 0, 0, 0,
      0.000593, 0.00058, 0.000573, 0.000549, 0.000551, 0.000522, 0.000507, 0.000512,
      0.000484, 0.000488, 0.000503, 0.000536, 0.001063, 0.001079, 0.001105, 0.00116,
      0.001214, 0.001239, 0.001191, 0.001889, 0.001958, 0.001905, 0.001991,
      0.001902, 0.002607, 0.002541, 0.0026, 0.002893, 0.003257, 0.003403, 0.004342,
      0.00409, 0.004372, 0.004935, 0.00651, 0.007123, 0.008217, 0.007851, 0.010173,
      0.010953, 0.012295, 0.01451, 0.01444, 0.018205, 0.018893, 0.020374, 0.024465,
      0.027439, 0.03012, 0.033395, 0.036923, 0.040892, 0.045833, 0.055402, 0.058047,
      0.069686, 0.077922, 0.092715, 0.098361, 0.116279, 0.136364, 0.153846,
      0.173913, 0.173913, 0.2, 0.222222, 0.333333, 0.333333, 0.5, 0, 0, 0.5,
      0.004766, 0.001051, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0.001037, 0, 0, 0.000782, 0.000714, 0.000693, 0.000672, 0.000646,
      0.000613, 0.000599, 0.000573, 0.000563, 0.000581, 0.000574, 0.000576,
      0.000573, 0.000617, 0.000617, 0.000659, 0.000668, 0.000662, 0.000701,
      0.000727, 0.000697, 0.000746, 0.000798, 0.000772, 0.000815, 0.001636,
      0.001684, 0.001789, 0.00178, 0.00194, 0.002177, 0.002322, 0.003354, 0.002606,
      0.002926, 0.003295, 0.003425, 0.005362, 0.005731, 0.00452, 0.007126, 0.007653,
      0.007792, 0.008011, 0.007663, 0.01005, 0.00974, 0.01227, 0.014493, 0.017467,
      0.018868, 0.020492, 0.023762, 0.028398, 0.03423, 0.038043, 0.050725, 0.057762,
      0.068627, 0.082474, 0.089552, 0.107692, 0.12766, 0.142857, 0.133333, 0.150943,
      0.157895, 0.2, 0.181818, 0.25, 0.333333, 0.2, 0.5, 0.5, 0.003566, 0.000907, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.001151, 0.001186, 0.001229, 0.001295,
      0.001195, 0.001164, 0.001027, 0.000987, 0, 0, 0, 0, 0, 0, 0.000561, 0.000551,
      0.000546, 0.000528, 0.000531, 0.000508, 0.000497, 0.000503, 0.00048, 0.000486,
      0.001, 0.001066, 0.001061, 0.001077, 0.001104, 0.001157, 0.001208, 0.001235,
      0.001786, 0.001886, 0.001951, 0.001901, 0.001984, 0.002537, 0.002603,
      0.002549, 0.003262, 0.003639, 0.003289, 0.00432, 0.00444, 0.005214, 0.00559,
      0.006329, 0.00672, 0.007452, 0.008613, 0.01005, 0.010363, 0.011148, 0.012552,
      0.014815, 0.017199, 0.018592, 0.022069, 0.024348, 0.025197, 0.028346,
      0.031201, 0.034749, 0.041801, 0.043137, 0.053333, 0.058997, 0.067606,
      0.075472, 0.085308, 0.103704, 0.109091, 0.131579, 0.131579, 0.151515,
      0.157895, 0.157895, 0.25, 0.285714, 0, 0.5, 0, 0, 0.333333, 0.004714,
      0.000961, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0.000941, 0, 0, 0.00073, 0.000673, 0.000657, 0.000641, 0.000621, 0.000595,
      0.000585, 0.000563, 0.000556, 0.000574, 0.000568, 0.000572, 0.00057, 0.000613,
      0.000614, 0.000655, 0.000664, 0.00066, 0.000697, 0.000722, 0.000696, 0.000743,
      0.000793, 0.00154, 0.001621, 0.001633, 0.001681, 0.001788, 0.001787, 0.001955,
      0.002198, 0.002347, 0.003405, 0.003955, 0.004441, 0.004996, 0.005236, 0.00551,
      0.005837, 0.006849, 0.007212, 0.007712, 0.007864, 0.008097, 0.010336,
      0.010169, 0.013115, 0.012448, 0.014733, 0.017778, 0.023077, 0.025157,
      0.028513, 0.033543, 0.040609, 0.045198, 0.053435, 0.061538, 0.073684,
      0.089888, 0.098361, 0.12069, 0.121951, 0.133333, 0.153846, 0.130435, 0.1875,
      0.25, 0.222222, 0.222222, 0, 0.25, 0.5, 0.003519, 0.000889, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0.001067, 0.001166, 0.0012, 0.001234, 0.001272,
      0.001154, 0.001093, 0, 0, 0, 0, 0, 0, 0, 0.000588, 0.000535, 0.000527,
      0.000524, 0.000511, 0.000515, 0.000497, 0.00049, 0.000497, 0.000477, 0.000969,
      0.000996, 0.001062, 0.00106, 0.001075, 0.001103, 0.001154, 0.001203, 0.001231,
      0.001785, 0.001881, 0.001942, 0.001897, 0.001978, 0.00254, 0.002605, 0.002563,
      0.003289, 0.003686, 0.004175, 0.004407, 0.004539, 0.005322, 0.005727,
      0.006515, 0.007018, 0.0078, 0.008857, 0.010235, 0.012645, 0.013621, 0.014957,
      0.017632, 0.017588, 0.02171, 0.022663, 0.025045, 0.029173, 0.032573, 0.035599,
      0.040323, 0.044068, 0.05, 0.057416, 0.063091, 0.072948, 0.082305, 0.094241,
      0.117647, 0.122449, 0.151515, 0.151515, 0.178571, 0.1875, 0.1875, 0.166667,
      0.2, 0.5, 0, 0, 0.333333, 0.004661, 0.000951, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000751, 0.000686, 0.00064,
      0.000628, 0.000616, 0.000601, 0.000581, 0.000574, 0.000556, 0.000551,
      0.000568, 0.000564, 0.000569, 0.000568, 0.00061, 0.000611, 0.00065, 0.00066,
      0.000656, 0.000693, 0.000719, 0.000695, 0.00074, 0.001577, 0.001536, 0.001614,
      0.001631, 0.001681, 0.001794, 0.001799, 0.001977, 0.003335, 0.003565,
      0.003456, 0.004005, 0.004498, 0.005111, 0.005376, 0.005607, 0.005906,
      0.006928, 0.00729, 0.007792, 0.007947, 0.008197, 0.010512, 0.013699, 0.013289,
      0.016807, 0.018762, 0.022624, 0.023669, 0.030238, 0.033684, 0.039216,
      0.047619, 0.053254, 0.064516, 0.07377, 0.090909, 0.098765, 0.109091, 0.117647,
      0.138889, 0.150943, 0.136364, 0.15, 0.153846, 0.166667, 0.285714, 0.285714,
      0.5, 0.5, 0.003481, 0.000878, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0.001118, 0.001081, 0.001178, 0.001206, 0.001217, 0.00122, 0, 0, 0, 0, 0, 0,
      0, 0, 0.000578, 0.000556, 0.000513, 0.000508, 0.000506, 0.000497, 0.000503,
      0.000488, 0.000484, 0.000493, 0.000951, 0.000969, 0.000993, 0.001059,
      0.001059, 0.001074, 0.001102, 0.001151, 0.001795, 0.001839, 0.001783,
      0.001876, 0.001934, 0.002523, 0.00263, 0.002545, 0.002614, 0.003233, 0.003334,
      0.003747, 0.004261, 0.004496, 0.005558, 0.005432, 0.005882, 0.006784,
      0.008811, 0.009639, 0.010811, 0.012487, 0.012889, 0.013905, 0.015317,
      0.018041, 0.020539, 0.022284, 0.023324, 0.025783, 0.030201, 0.033898,
      0.037162, 0.042553, 0.05036, 0.053571, 0.062016, 0.067797, 0.079208, 0.090498,
      0.105263, 0.116505, 0.139535, 0.142857, 0.178571, 0.173913, 0.153846,
      0.230769, 0.2, 0.25, 0, 0, 0.333333, 0.004586, 0.000939, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000794, 0.000769,
      0.000703, 0.00065, 0.000612, 0.000604, 0.000595, 0.000584, 0.000569, 0.000564,
      0.000549, 0.000546, 0.000563, 0.000561, 0.000566, 0.000566, 0.000606,
      0.000608, 0.000646, 0.000656, 0.000653, 0.00069, 0.000716, 0.000694, 0.001473,
      0.001571, 0.001533, 0.001611, 0.001634, 0.001688, 0.001808, 0.00273, 0.003008,
      0.003382, 0.003614, 0.003507, 0.004051, 0.004598, 0.005245, 0.005469,
      0.005666, 0.00597, 0.007001, 0.007362, 0.007884, 0.008043, 0.01108, 0.013369,
      0.013889, 0.016863, 0.017094, 0.019157, 0.023202, 0.028398, 0.03132, 0.039387,
      0.045455, 0.055556, 0.062696, 0.077586, 0.088496, 0.1, 0.109589, 0.122449,
      0.133333, 0.129032, 0.130435, 0.157895, 0.176471, 0.181818, 0.2, 0.4, 0.4,
      0.333333
    ),
    emi = c(
      0.004513, 0.037073, 0.032101, 0.02812, 0.025169, 0.022052, 0.018217, 0.016304,
      0.014395, 0.01232, 0.009395, 0.008841, 0.007495, 0.006593, 0.005214, 0.00454,
      0.006993, 0.013269, 0.020592, 0.026506, 0.030414, 0.034103, 0.039474,
      0.040775, 0.041331, 0.041978, 0.041897, 0.041014, 0.040028, 0.038532,
      0.036949, 0.035882, 0.03427, 0.033746, 0.032378, 0.031795, 0.031508, 0.030642,
      0.029887, 0.029783, 0.029602, 0.028769, 0.028108, 0.028208, 0.027891,
      0.026204, 0.025466, 0.02503, 0.024606, 0.023545, 0.022265, 0.021956, 0.020939,
      0.019595, 0.01906, 0.018205, 0.0188, 0.020325, 0.024535, 0.027562, 0.029412,
      0.028169, 0.031746, 0.032175, 0.036517, 0.05939, 0.034951, 0.020243, 0.015284,
      0.012245, 0.012048, 0.009592, 0.007792, 0.008086, 0.010169, 0.009146,
      0.009119, 0.009009, 0.007407, 0.006135, 0.007407, 0.008264, 0.005525,
      0.005263, 0.006944, 0.008621, 0.013158, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0.012322, 0.043113, 0.034304, 0.02729, 0.02229, 0.019211, 0.016649,
      0.015091, 0.01427, 0.012948, 0.012821, 0.012155, 0.011312, 0.010297, 0.01105,
      0.010381, 0.010296, 0.010959, 0.01194, 0.014184, 0.016641, 0.017808, 0.020752,
      0.022754, 0.02623, 0.029851, 0.030387, 0.030057, 0.029477, 0.029286, 0.029696,
      0.028402, 0.028002, 0.026699, 0.025434, 0.023823, 0.022209, 0.020196,
      0.019075, 0.017222, 0.016079, 0.014833, 0.013898, 0.012735, 0.011952,
      0.011955, 0.010949, 0.011173, 0.010463, 0.010408, 0.010062, 0.010621,
      0.010656, 0.01097, 0.012545, 0.015125, 0.017425, 0.019544, 0.020809, 0.021111,
      0.020752, 0.018923, 0.018062, 0.015385, 0.038801, 0.024621, 0.018018,
      0.011848, 0.010204, 0.01039, 0.010667, 0.010204, 0.010033, 0.00974, 0.012245,
      0.007246, 0.008734, 0.007547, 0.008197, 0.007905, 0.008097, 0.009756, 0.01087,
      0.014493, 0.014388, 0.009804, 0.010309, 0.014925, 0.015385, 0.021277,
      0.028571, 0.033333, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.001784, 0.035519, 0.032882,
      0.027885, 0.024497, 0.02201, 0.018027, 0.015166, 0.01435, 0.012322, 0.010091,
      0.008222, 0.007805, 0.006383, 0.005495, 0.005247, 0.008018, 0.012972,
      0.019584, 0.024707, 0.028986, 0.033453, 0.038136, 0.040206, 0.04147, 0.041096,
      0.041246, 0.039942, 0.039095, 0.037687, 0.036311, 0.034989, 0.034059,
      0.032813, 0.032415, 0.031379, 0.031109, 0.030426, 0.029865, 0.029684,
      0.028571, 0.028862, 0.028147, 0.027493, 0.026519, 0.026667, 0.025439,
      0.025371, 0.024434, 0.023929, 0.022179, 0.021587, 0.020557, 0.019683,
      0.018905, 0.018471, 0.018893, 0.020319, 0.023732, 0.025751, 0.029024, 0.02588,
      0.027685, 0.028822, 0.034483, 0.056769, 0.035654, 0.02, 0.014463, 0.011111,
      0.0125, 0.009852, 0.009804, 0.007958, 0.008264, 0.006944, 0.006289, 0.006289,
      0.006231, 0.007692, 0.00641, 0.007782, 0.008811, 0.005882, 0.005618, 0.007519,
      0.009434, 0.014706, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.011236, 0.040346,
      0.032597, 0.026915, 0.021401, 0.019153, 0.016032, 0.014418, 0.012974,
      0.013001, 0.011858, 0.011616, 0.010917, 0.010056, 0.010262, 0.010022,
      0.010576, 0.011827, 0.012535, 0.015038, 0.016997, 0.017467, 0.019206,
      0.023669, 0.02589, 0.028628, 0.028763, 0.029486, 0.029434, 0.028374, 0.028995,
      0.028197, 0.027813, 0.026554, 0.024837, 0.023282, 0.021277, 0.020196,
      0.018265, 0.017212, 0.015429, 0.01476, 0.013538, 0.013141, 0.012, 0.011243,
      0.011181, 0.010862, 0.010453, 0.010424, 0.009547, 0.010031, 0.009756,
      0.011447, 0.012626, 0.014311, 0.016949, 0.019474, 0.021882, 0.021028,
      0.020316, 0.018373, 0.017699, 0.016584, 0.037866, 0.023679, 0.015504,
      0.013667, 0.01199, 0.010283, 0.010471, 0.010782, 0.010309, 0.010169, 0.009836,
      0.008299, 0.011029, 0.008889, 0.007692, 0.008368, 0.00813, 0.008368, 0.010152,
      0.011299, 0.007634, 0.007692, 0.010526, 0.011236, 0.016393, 0.017241, 0.02439,
      0.033333, 0.038462, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0322, 0.030769, 0.027804,
      0.023742, 0.02087, 0.018921, 0.015933, 0.014019, 0.011535, 0.01029, 0.007968,
      0.007128, 0.005848, 0.005313, 0.005519, 0.007423, 0.012746, 0.020311,
      0.024722, 0.028424, 0.031991, 0.036364, 0.038883, 0.039773, 0.041451,
      0.039669, 0.038961, 0.037584, 0.037532, 0.035779, 0.034483, 0.033351,
      0.032568, 0.031639, 0.030842, 0.030592, 0.030557, 0.029985, 0.029665,
      0.029098, 0.028429, 0.028191, 0.027586, 0.026372, 0.02649, 0.025448, 0.024125,
      0.023457, 0.023242, 0.022013, 0.020779, 0.020279, 0.019828, 0.01906, 0.018241,
      0.019182, 0.019659, 0.023443, 0.024876, 0.028821, 0.024324, 0.025343,
      0.024972, 0.033462, 0.056241, 0.035385, 0.0194, 0.014286, 0.012605, 0.011312,
      0.010638, 0.01005, 0.010025, 0.00813, 0.008475, 0.007143, 0.006472, 0.006494,
      0.006452, 0.008032, 0.006734, 0.008264, 0.009479, 0.006289, 0.006061,
      0.008197, 0.010417, 0.016667, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.012037,
      0.039924, 0.031731, 0.027112, 0.021583, 0.018357, 0.015984, 0.014866,
      0.013252, 0.011869, 0.011752, 0.010763, 0.01147, 0.010787, 0.01, 0.010297,
      0.010204, 0.010804, 0.012064, 0.014085, 0.016442, 0.016438, 0.018817,
      0.023337, 0.026738, 0.02832, 0.028777, 0.028721, 0.028839, 0.028269, 0.027541,
      0.027599, 0.026365, 0.02561, 0.024691, 0.022583, 0.021253, 0.019369, 0.018265,
      0.016421, 0.015402, 0.014229, 0.013456, 0.012255, 0.011749, 0.011266,
      0.010533, 0.010424, 0.010086, 0.010438, 0.009644, 0.010277, 0.01, 0.011327,
      0.013061, 0.014298, 0.01701, 0.018817, 0.019666, 0.021018, 0.020095, 0.018328,
      0.015957, 0.016418, 0.036975, 0.021352, 0.014898, 0.013752, 0.011521,
      0.012136, 0.010363, 0.010582, 0.010899, 0.010471, 0.010274, 0.009967,
      0.008403, 0.011236, 0.00905, 0.007874, 0.008621, 0.008403, 0.008696, 0.010582,
      0.011834, 0.008065, 0.008197, 0.011364, 0.012346, 0.018182, 0.019608,
      0.027778, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.03351, 0.030088, 0.02693, 0.024645,
      0.020619, 0.01815, 0.015873, 0.013876, 0.01107, 0.009666, 0.008341, 0.00691,
      0.006061, 0.004883, 0.00533, 0.007786, 0.012889, 0.018779, 0.024155, 0.02836,
      0.032622, 0.036036, 0.037975, 0.040478, 0.040517, 0.039463, 0.037509,
      0.037037, 0.036806, 0.035693, 0.033676, 0.032967, 0.032058, 0.031362,
      0.030715, 0.029995, 0.029513, 0.029684, 0.029208, 0.028585, 0.028585, 0.02735,
      0.027056, 0.026497, 0.025269, 0.024283, 0.023645, 0.023409, 0.022127,
      0.021429, 0.021303, 0.020039, 0.018963, 0.019104, 0.018448, 0.018277,
      0.019961, 0.022531, 0.023083, 0.028716, 0.021448, 0.022978, 0.022654,
      0.031395, 0.053121, 0.036179, 0.019139, 0.012567, 0.012448, 0.010707,
      0.011547, 0.010893, 0.010283, 0.007692, 0.008333, 0.008721, 0.007353,
      0.006689, 0.006757, 0.006734, 0.008439, 0.007143, 0.00885, 0.010256, 0.006757,
      0.006579, 0.009009, 0.011628, 0.019231, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0.007319, 0.038534, 0.031399, 0.026794, 0.020683, 0.018293, 0.016284,
      0.014837, 0.012758, 0.012097, 0.011742, 0.011567, 0.010659, 0.010341,
      0.009677, 0.010045, 0.00927, 0.011601, 0.012255, 0.01355, 0.014065, 0.015782,
      0.019133, 0.021818, 0.024236, 0.027079, 0.028495, 0.028099, 0.027978,
      0.027576, 0.027333, 0.0275, 0.026445, 0.024788, 0.023683, 0.022427, 0.020466,
      0.019337, 0.017534, 0.016393, 0.015186, 0.01418, 0.013046, 0.012165, 0.011578,
      0.011025, 0.010533, 0.009823, 0.010373, 0.010043, 0.010424, 0.010332,
      0.010236, 0.011512, 0.012097, 0.014694, 0.017677, 0.019802, 0.01991, 0.021912,
      0.020179, 0.017986, 0.016279, 0.014805, 0.034796, 0.020833, 0.016334,
      0.011321, 0.011905, 0.011655, 0.009804, 0.010499, 0.010695, 0.01105, 0.010667,
      0.010417, 0.010101, 0.008547, 0.007663, 0.009259, 0.008097, 0.008929,
      0.008734, 0.009091, 0.011111, 0.0125, 0.008621, 0.00885, 0.0125, 0.013699,
      0.020408, 0.022222, 0.032258, 0, 0, 0, 0, 0, 0, 0, 0
    ),
    imm_int = c(
      23, 54, 51, 48, 47, 45, 44, 43, 42, 42, 41, 40, 40, 38, 37, 34, 33, 32, 35,
      45, 61, 84, 106, 128, 145, 158, 166, 169, 169, 166, 161, 155, 148, 140, 132,
      124, 117, 110, 103, 97, 91, 86, 81, 76, 72, 68, 64, 60, 57, 54, 51, 49, 45,
      42, 37, 33, 29, 25, 21, 18, 15, 13, 11, 9, 8, 7, 6, 5, 4, 3, 3, 2, 2, 2, 2, 1,
      1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 20,
      46, 42, 40, 39, 39, 38, 38, 38, 39, 39, 39, 40, 39, 37, 36, 35, 36, 36, 46,
      64, 87, 109, 128, 140, 145, 148, 145, 141, 135, 128, 121, 113, 106, 99, 92,
      85, 80, 74, 69, 64, 59, 56, 52, 49, 46, 44, 42, 40, 38, 36, 35, 33, 30, 27,
      25, 21, 19, 16, 14, 12, 10, 9, 8, 7, 6, 5, 4, 4, 4, 3, 3, 2, 2, 2, 2, 2, 2, 2,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 23, 54, 51,
      49, 47, 45, 44, 43, 42, 42, 41, 40, 40, 39, 37, 35, 33, 32, 35, 45, 61, 84,
      107, 129, 146, 159, 167, 170, 170, 167, 162, 156, 148, 141, 133, 125, 118,
      110, 104, 97, 92, 86, 81, 77, 73, 69, 64, 61, 58, 55, 52, 49, 46, 42, 38, 33,
      29, 25, 21, 18, 15, 13, 11, 9, 8, 7, 6, 5, 4, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 1,
      1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18, 46, 43, 41,
      39, 39, 39, 38, 39, 39, 39, 40, 40, 39, 38, 36, 36, 36, 36, 46, 65, 88, 110,
      128, 140, 147, 149, 145, 141, 135, 128, 121, 114, 106, 99, 93, 86, 80, 74, 69,
      64, 60, 56, 53, 49, 47, 44, 42, 40, 38, 37, 35, 33, 30, 28, 25, 22, 19, 16,
      14, 12, 10, 9, 8, 7, 6, 5, 5, 4, 4, 3, 3, 3, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 23, 56, 51, 49, 47, 45, 44,
      43, 42, 42, 41, 41, 40, 39, 37, 35, 33, 32, 35, 45, 63, 85, 108, 129, 147,
      160, 168, 171, 171, 168, 163, 157, 149, 142, 134, 126, 118, 111, 104, 98, 92,
      87, 82, 77, 73, 69, 65, 62, 59, 56, 53, 49, 46, 42, 38, 33, 29, 25, 21, 18,
      16, 13, 11, 9, 8, 7, 6, 5, 4, 3, 3, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18, 46, 43, 41, 40, 39, 39,
      39, 39, 39, 40, 40, 40, 39, 38, 36, 36, 36, 36, 46, 65, 88, 110, 128, 141,
      147, 148, 147, 143, 137, 131, 122, 115, 107, 100, 93, 86, 80, 75, 69, 65, 60,
      56, 53, 50, 47, 44, 42, 40, 39, 37, 35, 33, 31, 28, 25, 22, 19, 16, 14, 12,
      10, 9, 8, 7, 6, 5, 5, 4, 4, 3, 3, 3, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 23, 55, 52, 49, 47, 46, 44, 44, 43,
      42, 42, 41, 40, 39, 37, 35, 33, 32, 36, 45, 62, 85, 108, 130, 148, 161, 169,
      172, 172, 169, 164, 158, 150, 142, 135, 127, 119, 112, 105, 99, 93, 87, 82,
      78, 73, 70, 66, 62, 58, 56, 53, 50, 46, 42, 38, 34, 29, 25, 22, 18, 16, 13,
      11, 10, 8, 7, 6, 5, 4, 3, 3, 3, 2, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 18, 47, 43, 41, 40, 39, 39, 39, 39,
      39, 40, 40, 40, 39, 38, 36, 36, 36, 37, 46, 65, 89, 111, 130, 142, 148, 150,
      148, 143, 137, 132, 124, 115, 108, 101, 94, 87, 81, 75, 70, 65, 60, 56, 53,
      50, 47, 45, 42, 41, 39, 37, 35, 33, 31, 28, 25, 22, 19, 16, 14, 12, 10, 9, 8,
      7, 6, 5, 5, 4, 4, 3, 3, 3, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
      1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0
    ),
    mig_ch = c(
      2, 7, 10, 7, 8, 7, 5, 4, 4, 5, 4, 4, 3, 2, 1, 1, 0, 1, 1, 3, 3, 3, 6, 5, 10,
      11, 9, 13, 15, 12, 13, 18, 16, 20, 20, 15, 15, 11, 10, 13, 12, 10, 9, 9, 10,
      12, 9, 8, 10, 10, 9, 10, 8, 12, 9, 10, 9, 7, 5, 5, 5, 4, 4, 3, 3, 5, 3, 2, 2,
      1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, -1, 11, 11, 8, 6, 5, 4, 3, 4, 2, 3, 3, 3, 2, 3, 2, 3, 3, 3,
      -1, 0, 0, 1, 3, 4, 8, 7, 9, 10, 13, 16, 17, 12, 12, 11, 10, 10, 10, 9, 8, 8,
      8, 10, 9, 8, 10, 10, 5, 5, 5, 3, 4, 3, 3, 4, 5, 4, 3, 3, 1, 2, 1, 2, 1, 2, 0,
      1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 9, 7, 9, 7, 7, 6, 5, 4, 4, 4, 4, 2, 2, 1, 0, 1,
      1, 2, 3, 3, 6, 5, 9, 6, 11, 12, 9, 13, 16, 11, 14, 19, 17, 19, 19, 15, 14, 11,
      9, 12, 12, 10, 9, 9, 10, 11, 9, 8, 9, 10, 9, 10, 9, 12, 9, 9, 7, 6, 6, 5, 5,
      3, 3, 3, 4, 2, 2, 2, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 0, 0, -1, -1, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 13, 11, 9, 7, 5, 4, 3, 2, 3, 3,
      3, 3, 3, 3, 2, 3, 3, 3, 0, -1, 2, 1, 2, 2, 3, 7, 7, 10, 11, 15, 16, 16, 13,
      12, 10, 10, 9, 9, 9, 8, 9, 8, 10, 10, 9, 9, 7, 3, 4, 4, 3, 4, 3, 4, 5, 5, 3,
      4, 3, 2, 2, 2, 1, 1, 0, 0, 0, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 9, 9, 8, 9, 6, 7, 5, 5,
      4, 3, 4, 4, 2, 2, 1, 1, 1, 2, 2, 4, 5, 8, 6, 10, 7, 12, 12, 10, 14, 16, 12,
      13, 19, 16, 19, 17, 13, 12, 11, 9, 12, 10, 10, 9, 9, 10, 11, 9, 9, 9, 10, 10,
      12, 10, 11, 7, 6, 5, 5, 5, 4, 4, 3, 4, 5, 3, 3, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1,
      0, 0, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 12,
      12, 8, 7, 6, 4, 3, 3, 3, 4, 2, 3, 3, 3, 3, 2, 3, 3, -2, 0, 1, 4, 3, 3, 3, 4,
      8, 10, 11, 12, 15, 15, 15, 12, 12, 10, 10, 10, 9, 9, 8, 9, 9, 10, 11, 9, 7, 5,
      3, 4, 3, 3, 4, 4, 5, 4, 3, 2, 3, 2, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1,
      1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      4, 10, 10, 9, 8, 7, 5, 6, 4, 4, 4, 3, 3, 2, 1, 1, 1, 1, 1, 2, 3, 4, 7, 10, 8,
      10, 7, 12, 12, 12, 13, 15, 13, 15, 19, 16, 18, 16, 12, 12, 10, 9, 12, 11, 10,
      9, 10, 10, 12, 9, 9, 8, 9, 11, 12, 10, 9, 5, 5, 6, 6, 4, 4, 4, 4, 5, 3, 2, 2,
      2, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, -1, -1, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, -3, 12, 12, 9, 6, 6, 5, 3, 3, 2, 3, 3, 2, 2, 2, 3, 4, 3,
      2, -1, 0, 2, 3, 5, 3, 3, 4, 7, 10, 11, 12, 12, 14, 14, 15, 12, 11, 10, 9, 9,
      10, 10, 8, 10, 9, 11, 10, 7, 4, 4, 2, 3, 3, 4, 5, 5, 4, 4, 3, 3, 3, 2, 1, 2,
      1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
    ),
    spatial_unit = rep("Aargau", 808L),
  )


  ## Prepare starting population ----

  ### Population = CH ----
  # # Run next lines to generate the subsequent data frame
  # Create starting population
  # fso_population only includes 2018, filtering not necessary
  # fso_population |>
  #   # drop non-Swiss people
  #   dplyr::filter(nat != "int") |>
  #   # remove `nat`  from `population`
  #   select(-nat) |>
  #   constructive::construct()

  pop_sub_F_binat_F_CH <- tibble::tibble(
    year = rep("2018", 202L),
    spatial_unit = rep("Aargau", 202L),
    sex = rep(c("m", "f"), each = 101L),
    age = rep(seq(0, 100, by = 1), 2),
    n = c(
      2506, 2589, 2568, 2635, 2710, 2608, 2569, 2611, 2634, 2512, 2564, 2411, 2514,
      2531, 2559, 2571, 2535, 2515, 2799, 2739, 2837, 2916, 3020, 2865, 2920, 3052,
      3125, 3058, 3060, 3057, 2963, 2923, 3031, 2906, 3099, 3001, 3037, 3029, 3026,
      2936, 2847, 2897, 2747, 2824, 3066, 3046, 3219, 3435, 3595, 3689, 4001, 4084,
      4124, 4203, 4275, 4109, 4096, 3998, 3761, 3721, 3611, 3627, 3472, 3441, 3256,
      3146, 3053, 2845, 2876, 2797, 2824, 2738, 2709, 2557, 2439, 2351, 2111, 1895,
      1533, 1454, 1476, 1297, 1181, 1114, 1080, 875, 828, 704, 594, 485, 407, 293,
      229, 170, 115, 95, 65, 32, 17, 18, 9, 2377, 2472, 2524, 2497, 2403, 2395,
      2472, 2386, 2540, 2392, 2467, 2313, 2357, 2295, 2384, 2384, 2415, 2454, 2513,
      2620, 2620, 2777, 2838, 2872, 2925, 2859, 3127, 2998, 3056, 2961, 3006, 3000,
      2969, 2923, 2965, 3026, 3169, 3173, 2992, 2969, 2864, 2960, 3126, 3008, 3064,
      3091, 3285, 3601, 3801, 3859, 4113, 4133, 4266, 4285, 4371, 4302, 4124, 4088,
      4001, 3832, 3831, 3832, 3628, 3538, 3388, 3292, 3300, 3050, 3083, 2996, 2956,
      2888, 2895, 2795, 2731, 2650, 2379, 2166, 1927, 1881, 1805, 1695, 1694, 1524,
      1493, 1348, 1312, 1154, 1070, 913, 810, 618, 543, 435, 319, 238, 171, 115, 74,
      36, 54
    ),
  )


  ### Population = INT ----
  # # Run next lines to generate the subsequent data frame
  # Create starting population
  # fso_population only includes 2018, filtering not necessary
  # fso_population |>
  #   # drop Swiss people
  #   dplyr::filter(nat == "int") |>
  #   # remove `nat`  from `population`
  #   select(-nat) |>
  #   constructive::construct()

  pop_sub_F_binat_F_INT <- tibble::tibble(
    year = rep("2018", 202L),
    spatial_unit = rep("Aargau", 202L),
    sex = rep(c("m", "f"), each = 101L),
    age = rep(seq(0, 100, by = 1), 2),
    n = c(
      1025, 1028, 1138, 1033, 1043, 1043, 1104, 1042, 974, 958, 1018, 934, 910, 959,
      881, 858, 829, 777, 830, 822, 909, 912, 981, 992, 1072, 1265, 1341, 1424,
      1635, 1678, 1700, 1780, 1778, 1884, 1950, 1936, 2056, 2041, 1981, 1858, 1877,
      1850, 1808, 1721, 1641, 1610, 1678, 1585, 1529, 1572, 1503, 1576, 1531, 1574,
      1538, 1383, 1230, 1182, 1161, 986, 923, 819, 777, 712, 623, 515, 494, 458,
      490, 415, 417, 385, 371, 295, 328, 329, 333, 270, 326, 270, 242, 181, 190,
      144, 116, 76, 61, 43, 44, 39, 23, 23, 10, 9, 3, 3, 2, 1, 1, 3, 1, 951, 962,
      1026, 987, 989, 961, 994, 911, 1004, 936, 905, 884, 874, 905, 867, 777, 730,
      670, 705, 661, 730, 771, 835, 915, 938, 1086, 1231, 1357, 1400, 1448, 1514,
      1607, 1648, 1730, 1763, 1711, 1733, 1730, 1742, 1617, 1618, 1511, 1492, 1506,
      1422, 1370, 1432, 1338, 1249, 1292, 1224, 1220, 1185, 1116, 1124, 1033, 921,
      865, 900, 771, 687, 609, 585, 567, 528, 444, 422, 392, 385, 375, 392, 299,
      308, 245, 276, 229, 265, 244, 253, 247, 205, 184, 138, 139, 102, 97, 67, 65,
      47, 35, 30, 26, 19, 10, 11, 12, 3, 5, 2, 0, 2
    ),
  )



  ## Projections ----

  ### Swiss nationals ----
  sub_F_binat_F_CH <- propop(
    parameters = param_sub_F_binat_F_CH,
    year_first = 2019,
    year_last = 2021,
    population = pop_sub_F_binat_F_CH,
    subregional = FALSE,
    binational = FALSE
  )

  ## Tests ----

  ### Should match snapshot data
  expect_snapshot(constructive::construct(sub_F_binat_F_CH))

  ### Should fail because function expects two nationalities
  expect_error(
    propop(
      parameters = param_sub_F_binat_F_CH,
      year_first = 2019,
      year_last = 2021,
      population = pop_sub_F_binat_F_CH,
      subregional = FALSE,
      binational = TRUE
    )
  )


  ### Non-Swiss nationals ----
  sub_F_binat_F_INT <- propop(
    parameters = param_sub_F_binat_F_INT,
    year_first = 2019,
    year_last = 2021,
    population = pop_sub_F_binat_F_INT,
    subregional = FALSE,
    binational = FALSE
  )

  ## Tests ----
  ### Should match snapshot data
  expect_snapshot(constructive::construct(sub_F_binat_F_INT))

  ### Should fail because function expects two nationalities
  expect_error(
    propop(
      parameters = param_sub_F_binat_F_INT,
      year_first = 2019,
      year_last = 2021,
      population = pop_sub_F_binat_F_INT,
      subregional = FALSE,
      binational = TRUE
    )
  )

})








# °°°°°°°°°°°° hier weiter °°°°°°°°°°°°----

# /////////////////////////////////////////////////////
# 5 regions & 1 nationality ---------------------------
# /////////////////////////////////////////////////////

## Prepare FSO parameters ----

### Population = CH ----
# # Run next lines to generate the subsequent data frame
# fso_parameters |>
#   dplyr::filter(year < 2023) |>
#   # drop non-Swiss people
#   dplyr::filter(nat != "int") |>
#   # remove `nat`, `acq` and `births_int_ch` from `parameters`
#   select(-c(nat, acq, births_int_ch)) |>
#   constructive::construct()



# fso parameters for fictitious subregions
fso_parameters_sub <- fso_parameters |>
  # duplicating rows 5 times
  tidyr::uncount(5) |>
  # create 5 subregions
  dplyr::mutate(spatial_unit = rep(1:5, times = nrow(fso_parameters))) |>
  # divide the size of parameters with numbers by the number of regions (= 5);
  # otherwise the multiplication of lines will inflate the population size.
  dplyr::mutate(spatial_unit = as.character(spatial_unit))

# fso population for fictitious subregions
fso_population_sub <- fso_population |>
  dplyr::rename(n_tot = n) |>
  # duplicating rows 5 times
  tidyr::uncount(5) |>
  # create 5 subregions
  dplyr::mutate(spatial_unit = rep(1:5, times = nrow(fso_population))) |>
  dplyr::mutate(
    # Create fictitious n for each subregion
    n = dplyr::case_match(
      spatial_unit,
      1 ~ round(n_tot * 0.3),
      2 ~ round(n_tot * 0.25),
      3 ~ round(n_tot * 0.2),
      4 ~ round(n_tot * 0.15),
      5 ~ round(n_tot * 0.1),
      .default = NA
    ),
    .keep = "all"
  ) |>
  dplyr::mutate(spatial_unit = as.character(spatial_unit)) |>
  dplyr::select(-n_tot)


## Tests ----------------------------------------------------------------------
# Original: Two nationalities + mig_sub adding exactly up to zero across spatial units
# subregional = TRUE
# binational = TRUE
# mig_sub adds up to zero exactly
test_mig_sub_original <- propop(
  parameters = fso_parameters_sub |>
    # add subregional migration (adds up to zero exactly)
    mutate(mig_sub = 0.2),
  year_first = 2019,
  year_last = 2022,
  population = fso_population_sub,
  subregional = TRUE,
  binational = TRUE
)



#
#   # Case 2: Only one nationality provided
#   # subregional = TRUE
#   # binational = FALSE
#   # mig_sub adds up to zero exactly
#   test_mig_sub_exact <- propop(
#     # remove `nat`, `acq` and `births_int_ch` from `parameters`
#     parameters = fso_parameters_sub |>
#       # add subregional migration (adds up to zero exactly)
#       mutate(mig_sub = 0.2) |>
#       dplyr::filter(nat != "int") |>
#       select(-c(nat, acq, births_int_ch)),
#     year_first = 2019,
#     year_last = 2022,
#     # remove `nat`  from `population`
#     population = fso_population_sub |>
#       dplyr::filter(nat != "int") |>
#       select(-nat),
#     subregional = TRUE,
#     binational = FALSE
#   )
#
#
#   # Two for nationalities but values for "int" are zero in the data
#   # subregional = TRUE
#   # binational = TRUE
#   # # mig_sub adds up to zero exactly
#   # test_mig_sub_binational_TRUE <- propop(
#   #   # set values for nationality "int" = zero
#   #   parameters = fso_parameters_sub |>
#   #     # add subregional migration (adds up to zero exactly)
#   #     mutate(mig_sub = 0.2, .before = "spatial_unit") |>
#   #   # set values for nationality "int" = zero
#   #     mutate(births_int_ch = 0) |>
#   #     mutate(across(birth_rate:mig_sub, ~if_else(nat == "int", 0, .x))),
#   #   year_first = 2019,
#   #   year_last = 2022,
#   #   # set values for nationality "int" = zero
#   #   population = fso_population_sub |>
#   #     mutate(across(n, ~if_else(nat == "int", 0, .x))),
#   #   subregional = TRUE,
#   #   binational = TRUE
#   # )
#   #
#   # # Compare the output
#   # waldo::compare(
#   #   test_mig_sub_exact,
#   #   test_mig_sub_binational_TRUE |> filter(nat != "int") |> select(-nat)
#   # )
#
#
#   # Case 2: Only one nationality provided
#   # subregional = TRUE
#   # binational = FALSE
#   # mig_sub diverts slighty from 1
#   test_mig_sub_modified <- propop(
#     # remove `nat`, `acq` and `births_int_ch` from `parameters`
#     parameters = fso_parameters_sub |>
#       # mig_sub diverts slighty from 1 for one spatial unit
#       mutate(mig_sub = ifelse(spatial_unit == "1", 0.2 - 0.000000000001522, 0.2)) |>
#       dplyr::filter(nat != "int") |>
#       select(-c(nat, acq, births_int_ch)),
#     year_first = 2019,
#     year_last = 2022,
#     # remove `nat`  from `population`
#     population = fso_population_sub |>
#       dplyr::filter(nat != "int") |>
#       select(-nat),
#     subregional = TRUE,
#     binational = FALSE
#   )
#
#   # Compare the output
#   waldo::compare(
#     test_mig_sub_exact,
#     test_mig_sub_modified
#   )
#
#
#
#
#
#
#
#
#   # old code --------------------------
#
#
#
#
#
#
#   #
#   # test_that("tests propop: 1 region vs. 5 regions", {
#   #
#   #   skip_on_ci()
#   #
#
#   #
#   #   ## Run propop with 1 region ----
#   #   output_propop_1r <- propop(
#   #     parameters = parameters_short_1r,
#   #     year_first = 2019,
#   #     year_last = 2019,
#   #     age_groups = 51,
#   #     fert_first = 16,
#   #     fert_last = 50,
#   #     share_born_female = 100 / 205,
#   #     population = population_short_1r,
#   #     subregional = FALSE
#   #   )
#   #
#   #   # Run snapshot 1 region ----
#   #   expect_snapshot(constructive::construct(output_propop_1r))
#   #
#   #
#
#
#
#   # /////////////////////////////////////////////////////
#   # Subregions -----
#   # /////////////////////////////////////////////////////
#
#   #   ## FSO parameters with fictitious subregions ----
#   #   # fso_parameters |>
#   #   #   dplyr::filter(age < 51 & year == 2019) |>
#   #   #   # Create fictitious intra-cantonal migration parameter
#   #   #   dplyr::rowwise() |>
#   #   #   dplyr::mutate(
#   #   #     mig_sub_1 = {set.seed(1); round(rnorm(1, mean = 0, sd = 0.2), digits = 4)},
#   #   #     mig_sub_2 = {set.seed(2);round(rnorm(1, mean = 0, sd = 0.2), digits = 4)},
#   #   #     mig_sub_3 = {set.seed(3);round(rnorm(1, mean = 0, sd = 0.2), digits = 4)},
#   #   #     mig_sub_4 = {set.seed(4);round(rnorm(1, mean = 0, sd = 0.2), digits = 4)},
#   #   #     mig_sub_5 = 0 - sum(mig_sub_1, mig_sub_2,mig_sub_3,mig_sub_4)
#   #   #     # check = sum(mig_sub_1, mig_sub_2,mig_sub_3,mig_sub_4,mig_sub_5)
#   #   #   ) |>
#   #   #   pivot_longer(mig_sub_1:mig_sub_5,
#   #   #                names_to = "subregion",
#   #   #                values_to = "mig_sub") |>
#   #   #   dplyr::mutate(spatial_unit = as.character(stringr::str_extract(subregion, "(?<=mig_sub_).*"))) |>
#   #   #   # divide the size of parameters with numbers by the number of regions (=5),
#   #   #   # otherwise the multiplication of lines inflates the size of the population
#   #   #   dplyr::mutate_at(vars(imm_int, mig_ch), ~ ./5) |>
#   #   #   dplyr::select(-subregion) |>
#   #   #   constructive::construct()
#   #
#   #   parameters_short_5r <- tibble::tibble(
#   #     nat = rep(c("ch", "int"), each = 510L),
#   #     sex = rep(rep(c("m", "f"), 2), each = 255L),
#   #     age = rep(rep(seq(0, 50, by = 1), 4), each = 5L),
#   #     year = rep("2019", 1020L),
#   #     scen = rep("reference", 1020L),
#   #     birth_rate = rep(
#   #       c(
#   #         0, 0.00041, 0.000808, 0.001581, 0.003418, 0.006455, 0.010405, 0.016157,
#   #         0.02364, 0.032479, 0.042954, 0.055049, 0.068632, 0.083007, 0.09798, 0.111332,
#   #         0.121122, 0.125879, 0.122941, 0.112803, 0.097161, 0.078333, 0.05944, 0.042398,
#   #         0.028719, 0.018692, 0.011733, 0.006989, 0.00429, 0.00227, 0.001286, 0.000606,
#   #         0.000277, 0.000262, 0, 0.001381, 0.005993, 0.017009, 0.032641, 0.048974,
#   #         0.065594, 0.081725, 0.094398, 0.106007, 0.114386, 0.122848, 0.130621,
#   #         0.134582, 0.136562, 0.134367, 0.129289, 0.120395, 0.109997, 0.096929,
#   #         0.083624, 0.06944, 0.055859, 0.043528, 0.032069, 0.022818, 0.015167, 0.009358,
#   #         0.005302, 0.002804, 0.001454, 0.000698, 0
#   #       ),
#   #       rep(c(340L, 5L, 345L, 5L, 15L), c(1L, 33L, 1L, 31L, 1L))
#   #     ),
#   #     births_int_ch = rep(0.23487796250442164, 1020L),
#   #     mor = rep(
#   #       c(
#   #         0.004386, 0.000791, 0.000383, 0.000386, 0, 0.000388, 0.000412, 0.000395,
#   #         0.000392, 0.000388, 0.000386, 0.000391, 0.00079, 0.00071, 0.000726, 0.000702,
#   #         0.000683, 0.000661, 0.000348, 0.000342, 0.000328, 0.000321, 0.000327,
#   #         0.000336, 0.00034, 0.000328, 0.000341, 0.000641, 0.000661, 0.000653, 0.000655,
#   #         0.000675, 0.001045, 0.001028, 0.001083, 0.001406, 0.001297, 0.001632,
#   #         0.001545, 0.001739, 0.00194, 0.002162, 0.003348, 0.000417, 0.000401, 0.000393,
#   #         0, 0.000404, 0.000395, 0.00038, 0.000359, 0.000351, 0.000348, 0.000342,
#   #         0.000349, 0.00032, 0.000333, 0.000327, 0.000337, 0.000331, 0.000332, 0.000669,
#   #         0.000679, 0.000669, 0.000656, 0.000626, 0.000625, 0.000662, 0.000668,
#   #         0.000692, 0.00067, 0.000635, 0.00066, 0.000972, 0.000964, 0.000908, 0.001106,
#   #         0.001311, 0.001291, 0.003623, 0.000971, 0, 0.001172, 0.001214, 0.001293,
#   #         0.001206, 0.001205, 0.001079, 0.001062, 0, 0.000593, 0.00058, 0.000573,
#   #         0.000549, 0.000551, 0.000522, 0.000507, 0.000512, 0.000484, 0.000488,
#   #         0.000503, 0.000536, 0.001063, 0.001079, 0.001105, 0.00116, 0.001214, 0.001239,
#   #         0.001191, 0.001889, 0.001958, 0.001905, 0.004766, 0.001051, 0, 0.001037, 0,
#   #         0.000782, 0.000714, 0.000693, 0.000672, 0.000646, 0.000613, 0.000599,
#   #         0.000573, 0.000563, 0.000581, 0.000574, 0.000576, 0.000573, 0.000617,
#   #         0.000659, 0.000668, 0.000662, 0.000701, 0.000727, 0.000697, 0.000746,
#   #         0.000798, 0.000772
#   #       ),
#   #       rep(
#   #         c(
#   #           5L, 35L, 5L, 15L, 5L, 10L, 5L, 70L, 5L, 10L, 5L, 70L, 5L, 30L,
#   #           5L, 110L, 5L, 10L, 5L, 10L, 5L
#   #         ),
#   #         c(
#   #           4L, 1L, 17L, 1L, 7L, 1L, 15L, 1L, 2L, 1L, 31L, 1L, 7L, 1L,
#   #           24L, 1L, 1L, 1L, 13L, 1L, 9L
#   #         )
#   #       )
#   #     ),
#   #     emi = rep(
#   #       c(
#   #         0.002417, 0.005986, 0.005407, 0.005062, 0.004175, 0.004059, 0.003834,
#   #         0.003114, 0.002681, 0.002278, 0.00199, 0.00156, 0.001244, 0.001193, 0.00079,
#   #         0.000782, 0.000778, 0.000789, 0.001193, 0.001786, 0.002556, 0.003172,
#   #         0.003429, 0.003974, 0.004538, 0.005137, 0.005242, 0.00544, 0.005559, 0.005556,
#   #         0.005561, 0.0054, 0.005132, 0.005279, 0.004818, 0.00484, 0.004332, 0.004281,
#   #         0.004292, 0.003966, 0.003747, 0.003512, 0.003452, 0.00364, 0.003541, 0.003262,
#   #         0.003283, 0.003107, 0.002911, 0.002782, 0.002711, 0.003384, 0.003786,
#   #         0.003641, 0.003566, 0.003604, 0.003329, 0.00334, 0.003236, 0.003353, 0.002756,
#   #         0.002926, 0.002432, 0.002162, 0.002121, 0.002179, 0.001678, 0.001656,
#   #         0.002037, 0.003183, 0.003053, 0.003241, 0.004228, 0.004875, 0.005812,
#   #         0.006296, 0.006716, 0.007005, 0.006872, 0.006417, 0.005988, 0.005667,
#   #         0.004715, 0.004447, 0.00371, 0.003305, 0.00284, 0.002521, 0.002674, 0.002358,
#   #         0.002444, 0.002365, 0.002239, 0.002327, 0.002285, 0.002265, 0.002435,
#   #         0.002222, 0.002368, 0.002332, 0.004513, 0.037073, 0.032101, 0.02812, 0.025169,
#   #         0.022052, 0.018217, 0.016304, 0.014395, 0.01232, 0.009395, 0.008841, 0.007495,
#   #         0.006593, 0.005214, 0.00454, 0.006993, 0.013269, 0.020592, 0.026506, 0.030414,
#   #         0.034103, 0.039474, 0.040775, 0.041331, 0.041978, 0.041897, 0.041014,
#   #         0.040028, 0.038532, 0.036949, 0.035882, 0.03427, 0.033746, 0.032378, 0.031795,
#   #         0.031508, 0.030642, 0.029887, 0.029783, 0.029602, 0.028769, 0.028108,
#   #         0.028208, 0.027891, 0.026204, 0.025466, 0.02503, 0.024606, 0.023545, 0.022265,
#   #         0.012322, 0.043113, 0.034304, 0.02729, 0.02229, 0.019211, 0.016649, 0.015091,
#   #         0.01427, 0.012948, 0.012821, 0.012155, 0.011312, 0.010297, 0.01105, 0.010381,
#   #         0.010296, 0.010959, 0.01194, 0.014184, 0.016641, 0.017808, 0.020752, 0.022754,
#   #         0.02623, 0.029851, 0.030387, 0.030057, 0.029477, 0.029286, 0.029696, 0.028402,
#   #         0.028002, 0.026699, 0.025434, 0.023823, 0.022209, 0.020196, 0.019075,
#   #         0.017222, 0.016079, 0.014833, 0.013898, 0.012735, 0.011952, 0.011955,
#   #         0.010949, 0.011173, 0.010463, 0.010408, 0.010062
#   #       ),
#   #       rep(c(5L, 10L, 5L, 10L, 5L), c(66L, 1L, 3L, 1L, 131L))
#   #     ),
#   #     acq = rep(
#   #       c(
#   #         0, 0.023466, 0.012683, 0.015564, 0.015817, 0.016457, 0.017258, 0.016304,
#   #         0.017274, 0.01848, 0.021921, 0.027505, 0.03212, 0.037363, 0.040667, 0.044268,
#   #         0.041958, 0.039807, 0.034749, 0.03253, 0.027981, 0.022002, 0.01864, 0.013252,
#   #         0.011089, 0.007463, 0.007905, 0.007457, 0.008427, 0.008563, 0.010131,
#   #         0.011765, 0.012921, 0.014623, 0.015924, 0.016923, 0.017562, 0.017996,
#   #         0.018128, 0.018173, 0.018299, 0.018114, 0.016757, 0.016593, 0.01627, 0.015235,
#   #         0.014907, 0.014303, 0.01388, 0.013734, 0.012087, 0.014218, 0.015773, 0.016632,
#   #         0.017544, 0.018237, 0.016178, 0.016649, 0.018109, 0.018661, 0.01992, 0.020299,
#   #         0.022099, 0.024887, 0.033181, 0.040884, 0.051903, 0.059202, 0.058904,
#   #         0.053731, 0.048227, 0.040847, 0.031507, 0.02594, 0.023952, 0.022951, 0.021322,
#   #         0.019337, 0.017872, 0.016212, 0.016429, 0.015884, 0.017173, 0.018046,
#   #         0.018204, 0.019653, 0.02042, 0.019871, 0.020196, 0.020809, 0.021814, 0.022263,
#   #         0.021632, 0.02184, 0.022118, 0.021248, 0.020394, 0.019708, 0.018855, 0.018685,
#   #         0.016813, 0.016254
#   #       ),
#   #       rep(c(510L, 5L, 10L, 5L), c(1L, 5L, 1L, 95L))
#   #     ),
#   #     imm_int = rep(
#   #       c(
#   #         0.4, 3, 2.8, 2.6, 2.2, 2, 1.8, 1.6, 1.4, 1.2, 1, 0.8, 0.6, 0.8, 1, 1.2, 1.6,
#   #         1.8, 2, 2.4, 2.6, 2.8, 3, 3.2, 3, 2.8, 2.6, 2.4, 2.2, 2, 2.2, 2.4, 2.6, 2.4,
#   #         2.2, 2, 0.8, 2.6, 2.4, 2.2, 2, 1.8, 1.6, 1.4, 1.2, 1, 0.8, 1, 1.2, 1.6, 2.2,
#   #         2.6, 2.8, 3.2, 3.4, 3.2, 3, 2.6, 2.2, 2, 1.6, 1.4, 1.6, 1.8, 1.6, 4.6, 10.8,
#   #         10.2, 9.6, 9.4, 9, 8.8, 8.6, 8.4, 8.2, 8, 7.6, 7.4, 6.8, 6.6, 6.4, 7, 9, 12.2,
#   #         16.8, 21.2, 25.6, 29, 31.6, 33.2, 33.8, 33.2, 32.2, 31, 29.6, 28, 26.4, 24.8,
#   #         23.4, 22, 20.6, 19.4, 18.2, 17.2, 16.2, 15.2, 14.4, 13.6, 12.8, 12, 11.4,
#   #         10.8, 10.2, 4, 9.2, 8.4, 8, 7.8, 7.6, 7.8, 8, 7.8, 7.4, 7.2, 7, 7.2, 9.2,
#   #         12.8, 17.4, 21.8, 25.6, 28, 29, 29.6, 29, 28.2, 27, 25.6, 24.2, 22.6, 21.2,
#   #         19.8, 18.4, 17, 16, 14.8, 13.8, 12.8, 11.8, 11.2, 10.4, 9.8, 9.2, 8.8, 8.4, 8,
#   #         7.6, 7.2
#   #       ),
#   #       rep(
#   #         c(
#   #           5L, 10L, 5L, 10L, 5L, 10L, 5L, 25L, 5L, 10L, 15L, 5L, 10L,
#   #           5L, 10L, 5L, 10L, 5L, 10L, 15L, 5L, 10L, 5L, 10L, 5L, 10L, 5L,
#   #           10L, 35L, 30L, 5L, 10L, 5L, 10L, 5L, 10L, 5L, 10L, 15L, 5L, 10L,
#   #           5L
#   #         ),
#   #         c(
#   #           1L, 1L, 9L, 1L, 1L, 1L, 8L, 1L, 2L, 4L, 1L, 2L, 2L, 3L, 1L,
#   #           3L, 1L, 3L, 1L, 1L, 1L, 1L, 4L, 2L, 2L, 1L, 2L, 2L, 1L, 1L, 9L,
#   #           1L, 1L, 1L, 14L, 1L, 26L, 1L, 2L, 5L, 1L, 32L
#   #         )
#   #       )
#   #     ),
#   #     mig_ch = rep(
#   #       c(
#   #         3.4, 6.8, 5.2, 4.6, 3.2, 2, 1.4, 1.2, 0.4, 0.2, 0.4, 0, 0.2, 0, 0.2, 0.4, 0.8,
#   #         1.2, 1, 1.2, 1.4, 1, 0.2, 0, -1.4, -3.6, -3.8, -2.6, -2, -1, 1.6, 2.2, 2.4,
#   #         3.4, 3.2, 3.8, 3.6, 3.4, 3.2, 2.8, 3, 2.4, 1.8, 2, 1.6, 1.4, 1.2, 1, 5.4, 4.4,
#   #         4.6, 3.8, 3.2, 2.6, 2.2, 1.4, 1, 1.4, 1.8, 2, 2.2, 2, 1.6, 0.8, 0, -0.6, 0,
#   #         -0.8, -1, -2.6, -3.8, -2, -4.2, -1.6, -1.2, 0.4, 1.2, 2.8, 3.2, 3, 2.4, 2.6,
#   #         3.6, 3.2, 2.8, 2.4, 1.8, 1.6, 1.2, 1.4, 0.4, 1.4, 2, 1.4, 1.6, 1.4, 1, 0.8, 1,
#   #         0.8, 0.6, 0.4, 0.2, 0, 0.2, 0.6, 1.2, 1, 2, 2.2, 1.8, 2.6, 3, 2.4, 2.6, 3.6,
#   #         3.2, 4, 3, 2.2, 2, 2.6, 2.4, 2, 1.8, 2, 2.4, 1.8, 1.6, 2, 1.8, -0.2, 2.2, 1.6,
#   #         1.2, 1, 0.8, 0.6, 0.8, 0.4, 0.6, 0.4, 0.6, 0.4, 0.6, -0.2, 0, 0.2, 0.6, 0.8,
#   #         1.6, 1.4, 1.8, 2, 2.6, 3.2, 3.4, 2.4, 2.2, 2, 1.8, 1.6, 2, 1.8, 1.6, 2, 1,
#   #         0.6
#   #       ),
#   #       rep(
#   #         c(
#   #           5L, 10L, 5L, 10L, 5L, 10L, 5L, 10L, 5L, 10L, 5L, 10L, 5L, 10L,
#   #           5L, 10L, 5L, 20L, 5L, 10L, 5L, 10L, 5L, 10L, 5L, 10L, 15L, 5L,
#   #           10L, 5L, 10L, 5L, 10L, 5L, 10L, 5L, 15L, 5L, 15L, 5L, 10L, 5L,
#   #           10L, 5L, 15L, 5L, 15L, 5L, 10L, 15L, 5L
#   #         ),
#   #         c(
#   #           14L, 1L, 20L, 1L, 1L, 1L, 17L, 1L, 1L, 2L, 17L, 1L, 4L, 1L,
#   #           1L, 1L, 1L, 1L, 11L, 1L, 1L, 1L, 2L, 1L, 1L, 1L, 1L, 11L, 2L,
#   #           5L, 1L, 4L, 1L, 2L, 1L, 7L, 1L, 3L, 1L, 1L, 1L, 10L, 1L, 1L,
#   #           1L, 1L, 1L, 3L, 1L, 1L, 1L
#   #         )
#   #       )
#   #     ),
#   #     spatial_unit = rep(c("1", "2", "3", "4", "5"), 204),
#   #     mig_sub = rep(c(-0.1253, -0.1794, -0.1924, 0.0434, 0.4537), 204),
#   #   )
#   #
#   #   ## FSO population with fictitious subregions ----
#   #   # fso_population |>
#   #   #   dplyr::rename(n_tot = n) |>
#   #   #   # duplicating rows 5 times
#   #   #   tidyr::uncount(5) |>
#   #   #   # create 5 subregions
#   #   #   dplyr::mutate(spatial_unit = rep(1:5, times = nrow(fso_population))) |>
#   #   #   dplyr::mutate(
#   #   #     # Create fictitious n
#   #   #     n = case_match(
#   #   #       spatial_unit,
#   #   #       1 ~ round(n_tot * 0.3),
#   #   #       2 ~ round(n_tot * 0.25),
#   #   #       3 ~ round(n_tot * 0.2),
#   #   #       4 ~ round(n_tot * 0.15),
#   #   #       # 5 ~ round(n_tot * 0.1),
#   #   #       .default = NA
#   #   #     ),
#   #   #     .keep = "all"
#   #   #   ) |>
#   #   #   # create region 5 by subtracting sum of 1:4 from original n to get exact same n
#   #   #   # (avoid rounding errors)
#   #   #   ## get sum of regions 1-4
#   #   #   dplyr::mutate(sum = sum(n, na.rm = TRUE), .by=c(year,nat,sex,age)) |>
#   #   #   ## compute region 5
#   #   #   dplyr::mutate(
#   #   #     n = case_match(
#   #   #       spatial_unit,
#   #   #       5 ~ (n_tot - sum),
#   #   #       .default = n
#   #   #     )) |>
#   #   #   dplyr::mutate(spatial_unit = as.character(spatial_unit)) |>
#   #   #   dplyr::select(-n_tot, -sum) |>
#   #   #   dplyr::filter(age < 51) |>
#   #   #   constructive::construct()
#   #
#   #   population_short_5r <- tibble::tibble(
#   #     year = rep("2018", 1020L),
#   #     spatial_unit = rep(c("1", "2", "3", "4", "5"), 204),
#   #     nat = rep(c("ch", "int"), each = 510L),
#   #     sex = rep(rep(c("m", "f"), 2), each = 255L),
#   #     age = rep(rep(seq(0, 50, by = 1), 4), each = 5L),
#   #     n = c(
#   #       752, 626, 501, 376, 251, 777, 647, 518, 388, 259, 770, 642,
#   #       514, 385, 257, 790, 659, 527, 395, 264, 813, 678, 542, 406, 271,
#   #       782, 652, 522, 391, 261, 771, 642, 514, 385, 257, 783, 653, 522,
#   #       392, 261, 790, 658, 527, 395, 264, 754, 628, 502, 377, 251, 769,
#   #       641, 513, 385, 256, 723, 603, 482, 362, 241, 754, 628, 503, 377,
#   #       252, 759, 633, 506, 380, 253, 768, 640, 512, 384, 255, 771, 643,
#   #       514, 386, 257, 760, 634, 507, 380, 254, 754, 629, 503, 377, 252,
#   #       840, 700, 560, 420, 279, 822, 685, 548, 411, 273, 851, 709, 567,
#   #       426, 284, 875, 729, 583, 437, 292, 906, 755, 604, 453, 302, 860,
#   #       716, 573, 430, 286, 876, 730, 584, 438, 292, 916, 763, 610, 458,
#   #       305, 938, 781, 625, 469, 312, 917, 764, 612, 459, 306, 918, 765,
#   #       612, 459, 306, 917, 764, 611, 459, 306, 889, 741, 593, 444, 296,
#   #       877, 731, 585, 438, 292, 909, 758, 606, 455, 303, 872, 726, 581,
#   #       436, 291, 930, 775, 620, 465, 309, 900, 750, 600, 450, 301, 911,
#   #       759, 607, 456, 304, 909, 757, 606, 454, 303, 908, 756, 605, 454,
#   #       303, 881, 734, 587, 440, 294, 854, 712, 569, 427, 285, 869, 724,
#   #       579, 435, 290, 824, 687, 549, 412, 275, 847, 706, 565, 424, 282,
#   #       920, 766, 613, 460, 307, 914, 762, 609, 457, 304, 966, 805, 644,
#   #       483, 321, 1030, 859, 687, 515, 344, 1078, 899, 719, 539, 360,
#   #       1107, 922, 738, 553, 369, 1200, 1000, 800, 600, 401, 713, 594,
#   #       475, 357, 238, 742, 618, 494, 371, 247, 757, 631, 505, 379, 252,
#   #       749, 624, 499, 375, 250, 721, 601, 481, 360, 240, 718, 599, 479,
#   #       359, 240, 742, 618, 494, 371, 247, 716, 596, 477, 358, 239, 762,
#   #       635, 508, 381, 254, 718, 598, 478, 359, 239, 740, 617, 493, 370,
#   #       247, 694, 578, 463, 347, 231, 707, 589, 471, 354, 236, 688, 574,
#   #       459, 344, 230, 715, 596, 477, 358, 238, 715, 596, 477, 358, 238,
#   #       724, 604, 483, 362, 242, 736, 614, 491, 368, 245, 754, 628, 503,
#   #       377, 251, 786, 655, 524, 393, 262, 786, 655, 524, 393, 262, 833,
#   #       694, 555, 417, 278, 851, 710, 568, 426, 283, 862, 718, 574, 431,
#   #       287, 878, 731, 585, 439, 292, 858, 715, 572, 429, 285, 938, 782,
#   #       625, 469, 313, 899, 750, 600, 450, 299, 917, 764, 611, 458, 306,
#   #       888, 740, 592, 444, 297, 902, 752, 601, 451, 300, 900, 750, 600,
#   #       450, 300, 891, 742, 594, 445, 297, 877, 731, 585, 438, 292, 890,
#   #       741, 593, 445, 296, 908, 756, 605, 454, 303, 951, 792, 634, 475,
#   #       317, 952, 793, 635, 476, 317, 898, 748, 598, 449, 299, 891, 742,
#   #       594, 445, 297, 859, 716, 573, 430, 286, 888, 740, 592, 444, 296,
#   #       938, 782, 625, 469, 312, 902, 752, 602, 451, 301, 919, 766, 613,
#   #       460, 306, 927, 773, 618, 464, 309, 986, 821, 657, 493, 328, 1080,
#   #       900, 720, 540, 361, 1140, 950, 760, 570, 381, 1158, 965, 772,
#   #       579, 385, 1234, 1028, 823, 617, 411, 308, 256, 205, 154, 102,
#   #       308, 257, 206, 154, 103, 341, 284, 228, 171, 114, 310, 258, 207,
#   #       155, 103, 313, 261, 209, 156, 104, 313, 261, 209, 156, 104, 331,
#   #       276, 221, 166, 110, 313, 260, 208, 156, 105, 292, 244, 195, 146,
#   #       97, 287, 240, 192, 144, 95, 305, 254, 204, 153, 102, 280, 234,
#   #       187, 140, 93, 273, 228, 182, 136, 91, 288, 240, 192, 144, 95,
#   #       264, 220, 176, 132, 89, 257, 214, 172, 129, 86, 249, 207, 166,
#   #       124, 83, 233, 194, 155, 117, 78, 249, 208, 166, 124, 83, 247,
#   #       206, 164, 123, 82, 273, 227, 182, 136, 91, 274, 228, 182, 137,
#   #       91, 294, 245, 196, 147, 99, 298, 248, 198, 149, 99, 322, 268,
#   #       214, 161, 107, 380, 316, 253, 190, 126, 402, 335, 268, 201, 135,
#   #       427, 356, 285, 214, 142, 490, 409, 327, 245, 164, 503, 420, 336,
#   #       252, 167, 510, 425, 340, 255, 170, 534, 445, 356, 267, 178, 533,
#   #       444, 356, 267, 178, 565, 471, 377, 283, 188, 585, 488, 390, 292,
#   #       195, 581, 484, 387, 290, 194, 617, 514, 411, 308, 206, 612, 510,
#   #       408, 306, 205, 594, 495, 396, 297, 199, 557, 464, 372, 279, 186,
#   #       563, 469, 375, 282, 188, 555, 462, 370, 278, 185, 542, 452, 362,
#   #       271, 181, 516, 430, 344, 258, 173, 492, 410, 328, 246, 165, 483,
#   #       402, 322, 242, 161, 503, 420, 336, 252, 167, 476, 396, 317, 238,
#   #       158, 459, 382, 306, 229, 153, 472, 393, 314, 236, 157, 451, 376,
#   #       301, 225, 150, 285, 238, 190, 143, 95, 289, 240, 192, 144, 97,
#   #       308, 256, 205, 154, 103, 296, 247, 197, 148, 99, 297, 247, 198,
#   #       148, 99, 288, 240, 192, 144, 97, 298, 248, 199, 149, 100, 273,
#   #       228, 182, 137, 91, 301, 251, 201, 151, 100, 281, 234, 187, 140,
#   #       94, 272, 226, 181, 136, 90, 265, 221, 177, 133, 88, 262, 218,
#   #       175, 131, 88, 272, 226, 181, 136, 90, 260, 217, 173, 130, 87,
#   #       233, 194, 155, 117, 78, 219, 182, 146, 110, 73, 201, 168, 134,
#   #       100, 67, 212, 176, 141, 106, 70, 198, 165, 132, 99, 67, 219,
#   #       182, 146, 110, 73, 231, 193, 154, 116, 77, 250, 209, 167, 125,
#   #       84, 274, 229, 183, 137, 92, 281, 234, 188, 141, 94, 326, 272,
#   #       217, 163, 108, 369, 308, 246, 185, 123, 407, 339, 271, 204, 136,
#   #       420, 350, 280, 210, 140, 434, 362, 290, 217, 145, 454, 378, 303,
#   #       227, 152, 482, 402, 321, 241, 161, 494, 412, 330, 247, 165, 519,
#   #       432, 346, 260, 173, 529, 441, 353, 264, 176, 513, 428, 342, 257,
#   #       171, 520, 433, 347, 260, 173, 519, 432, 346, 260, 173, 523, 436,
#   #       348, 261, 174, 485, 404, 323, 243, 162, 485, 404, 324, 243, 162,
#   #       453, 378, 302, 227, 151, 448, 373, 298, 224, 149, 452, 376, 301,
#   #       226, 151, 427, 356, 284, 213, 142, 411, 342, 274, 206, 137, 430,
#   #       358, 286, 215, 143, 401, 334, 268, 201, 134, 375, 312, 250, 187,
#   #       125, 388, 323, 258, 194, 129, 367, 306, 245, 184, 122
#   #     ),
#   #   )
#   #
#   #   # run propop 5 regions ----
#   #   output_propop_5r <- propop(
#   #     parameters = parameters_short_5r,
#   #     year_first = 2019,
#   #     year_last = 2019,
#   #     age_groups = 51,
#   #     fert_first = 16,
#   #     fert_last = 50,
#   #     share_born_female = 100 / 205,
#   #     population = population_short_5r,
#   #     subregional = TRUE
#   #   )
#   #
#   #   # run snapshot 5 subregions ----
#   #   expect_snapshot(constructive::construct(output_propop_5r))
#   #
#
#
#
#
#
#
#
#
#
#
#
#   # prepare comparison 1 vs 5 regions ----
#
#
#
#
#
#   #   ## prepare data for comparison ----
#   #   ### n in starting populations should be identical in both versions
#   #   ### simplify to make comparable
#   #   compare_pop1r <- population_short_1r |>
#   #     select(-spatial_unit) |>
#   #     arrange(year, nat, sex, age)
#   #   ### simplify to make comparable
#   #   compare_pop5r <- population_short_5r |>
#   #     summarise(n = sum(n), .by = c(year, nat, sex, age)) |>
#   #     arrange(year, nat, sex, age)
#   #
#   #
#   #
#   #   # run equal starting populations ----
#   #   expect_equal(compare_pop1r, compare_pop5r)
#   #
#   #
#   #   ### parameters should be identical in both versions
#   #   compare_params_1r <- parameters_short_1r |>
#   #     dplyr::select(-spatial_unit) |>
#   #     arrange(year, nat, sex, age)
#   #
#   #   compare_params_5r <- parameters_short_5r |>
#   #     # remove column that includes redundancy
#   #     dplyr::select(-mig_sub, -spatial_unit) |>
#   #     # remove redundant columns
#   #     dplyr::distinct(year, nat, sex, age, .keep_all = TRUE) |>
#   #     # multiply columns with number-of-people parameters
#   #     # by number of regions to get the n right again
#   #     dplyr::mutate_at(vars(imm_int, mig_ch), ~ . * 5) |>
#   #     arrange(year, nat, sex, age)
#   #
#   #   # run equal parameters ----
#   #   expect_equal(compare_params_1r, compare_params_5r)
#   #
#   #
#   #   ## equal projection results
#   #   # simplify data for comparison
#   #   output_super <- output_propop_1r |>
#   #     select(year, age, sex, nat, n) |>
#   #     arrange(year, nat, sex, age)
#   #
#   #   output_subregions <- output_propop_5r |>
#   #     dplyr::mutate(n_check = sum(n, na.rm = TRUE), .by = c(year, nat, sex, age)) |>
#   #     # remove column that includes redundancy
#   #     dplyr::select(-n, -spatial_unit) |>
#   #     # rename n_check
#   #     rename(n = n_check) |>
#   #     # remove redundant columns
#   #     dplyr::distinct(year, nat, sex, age, .keep_all = TRUE) |>
#   #     select(year, age, sex, nat, n) |>
#   #     arrange(year, nat, sex, age)
#   #
#   #   # run equal output ----
#   #   expect_equal(output_super, output_subregions, ignore_attr = TRUE)
#   # })
#   #
#   # options(cli.default_handler = NULL)
#
#
#
# })
