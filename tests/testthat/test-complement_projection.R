test_that("snapshot test complement_projection()", {

  skip_on_ci()

  # create skeleton with variable labels and levels
  # prepare_skeleton(
  #   age_groups = 101,
  #   year_first = 2019,
  #   year_last = 2019,
  #   spatial_unit = "Canton"
  # ) |>
  #   constructive::construct()

  empty_df <- tibble::tibble(
    age = rep(0:100, 8),
    sex = factor(rep(rep(c("m", "f"), 4), each = 101L), levels = c("m", "f")),
    nat = factor(rep(rep(c("ch", "int"), 2), each = 202L)),
    year = rep(2018:2019, each = 404L),
    spatial_unit = factor(rep("Canton", 808L)),
  ) |>
    structure(
      out.attrs = list(
        dim = c(age = 101L, sex = 2L, nat = 2L, year = 2L, spatial_unit = 1L),
        dimnames = list(
          age = c(
            "age=  0", "age=  1", "age=  2", "age=  3", "age=  4", "age=  5", "age=  6",
            "age=  7", "age=  8", "age=  9", "age= 10", "age= 11", "age= 12", "age= 13",
            "age= 14", "age= 15", "age= 16", "age= 17", "age= 18", "age= 19", "age= 20",
            "age= 21", "age= 22", "age= 23", "age= 24", "age= 25", "age= 26", "age= 27",
            "age= 28", "age= 29", "age= 30", "age= 31", "age= 32", "age= 33", "age= 34",
            "age= 35", "age= 36", "age= 37", "age= 38", "age= 39", "age= 40", "age= 41",
            "age= 42", "age= 43", "age= 44", "age= 45", "age= 46", "age= 47", "age= 48",
            "age= 49", "age= 50", "age= 51", "age= 52", "age= 53", "age= 54", "age= 55",
            "age= 56", "age= 57", "age= 58", "age= 59", "age= 60", "age= 61", "age= 62",
            "age= 63", "age= 64", "age= 65", "age= 66", "age= 67", "age= 68", "age= 69",
            "age= 70", "age= 71", "age= 72", "age= 73", "age= 74", "age= 75", "age= 76",
            "age= 77", "age= 78", "age= 79", "age= 80", "age= 81", "age= 82", "age= 83",
            "age= 84", "age= 85", "age= 86", "age= 87", "age= 88", "age= 89", "age= 90",
            "age= 91", "age= 92", "age= 93", "age= 94", "age= 95", "age= 96", "age= 97",
            "age= 98", "age= 99", "age=100"
          ),
          sex = c("sex=m", "sex=f"),
          nat = c("nat=ch", "nat=int"),
          year = c("year=2018", "year=2019"),
          spatial_unit = "spatial_unit=Canton"
        )
      )
    )

  # # create df with raw projection results
  # project_raw(
  #   parameters = fso_parameters |> dplyr::filter(year == 2019),
  #   year_first = 2019,
  #   year_last = 2019,
  #   age_groups = 101,
  #   fert_first = 16,
  #   fert_last = 50,
  #   share_born_female = 100 / 205,
  #   n = fso_population |> dplyr::pull(n),
  #   subregional = FALSE
  # ) |>
  #   constructive::construct()

  raw_df <- data.frame(
    N = c(
      2506, 2589, 2568, 2635, 2710, 2608, 2569, 2611, 2634, 2512, 2564, 2411, 2514,
      2531, 2559, 2571, 2535, 2515, 2799, 2739, 2837, 2916, 3020, 2865, 2920, 3052,
      3125, 3058, 3060, 3057, 2963, 2923, 3031, 2906, 3099, 3001, 3037, 3029, 3026,
      2936, 2847, 2897, 2747, 2824, 3066, 3046, 3219, 3435, 3595, 3689, 4001, 4084,
      4124, 4203, 4275, 4109, 4096, 3998, 3761, 3721, 3611, 3627, 3472, 3441, 3256,
      3146, 3053, 2845, 2876, 2797, 2824, 2738, 2709, 2557, 2439, 2351, 2111, 1895,
      1533, 1454, 1476, 1297, 1181, 1114, 1080, 875, 828, 704, 594, 485, 407, 293,
      229, 170, 115, 95, 65, 32, 17, 18, 9, 2377, 2472, 2524, 2497, 2403, 2395,
      2472, 2386, 2540, 2392, 2467, 2313, 2357, 2295, 2384, 2384, 2415, 2454, 2513,
      2620, 2620, 2777, 2838, 2872, 2925, 2859, 3127, 2998, 3056, 2961, 3006, 3000,
      2969, 2923, 2965, 3026, 3169, 3173, 2992, 2969, 2864, 2960, 3126, 3008, 3064,
      3091, 3285, 3601, 3801, 3859, 4113, 4133, 4266, 4285, 4371, 4302, 4124, 4088,
      4001, 3832, 3831, 3832, 3628, 3538, 3388, 3292, 3300, 3050, 3083, 2996, 2956,
      2888, 2895, 2795, 2731, 2650, 2379, 2166, 1927, 1881, 1805, 1695, 1694, 1524,
      1493, 1348, 1312, 1154, 1070, 913, 810, 618, 543, 435, 319, 238, 171, 115, 74,
      36, 54, 1025, 1028, 1138, 1033, 1043, 1043, 1104, 1042, 974, 958, 1018, 934,
      910, 959, 881, 858, 829, 777, 830, 822, 909, 912, 981, 992, 1072, 1265, 1341,
      1424, 1635, 1678, 1700, 1780, 1778, 1884, 1950, 1936, 2056, 2041, 1981, 1858,
      1877, 1850, 1808, 1721, 1641, 1610, 1678, 1585, 1529, 1572, 1503, 1576, 1531,
      1574, 1538, 1383, 1230, 1182, 1161, 986, 923, 819, 777, 712, 623, 515, 494,
      458, 490, 415, 417, 385, 371, 295, 328, 329, 333, 270, 326, 270, 242, 181,
      190, 144, 116, 76, 61, 43, 44, 39, 23, 23, 10, 9, 3, 3, 2, 1, 1, 3, 1, 951,
      962, 1026, 987, 989, 961, 994, 911, 1004, 936, 905, 884, 874, 905, 867, 777,
      730, 670, 705, 661, 730, 771, 835, 915, 938, 1086, 1231, 1357, 1400, 1448,
      1514, 1607, 1648, 1730, 1763, 1711, 1733, 1730, 1742, 1617, 1618, 1511, 1492,
      1506, 1422, 1370, 1432, 1338, 1249, 1292, 1224, 1220, 1185, 1116, 1124, 1033,
      921, 865, 900, 771, 687, 609, 585, 567, 528, 444, 422, 392, 385, 375, 392,
      299, 308, 245, 276, 229, 265, 244, 253, 247, 205, 184, 138, 139, 102, 97, 67,
      65, 47, 35, 30, 26, 19, 10, 11, 12, 3, 5, 2, 0, 2, 2510.09258997647,
      2551.023432745605, 2631.0016651859396, 2609.017765899254, 2669.9996910000004,
      2738.000564, 2633.001198, 2593.998901, 2631.9991179999997, 2653.9983859999998,
      2535.9954019999996, 2592.00023581182, 2442.0016542115995, 2548.0021190986804,
      2570.999033160524, 2599.9990829802123, 2610.0002119241512, 2573.995985965201,
      2548.998923492565, 2832.00169638514, 2767.999204600039, 2862.99928299298,
      2938.0022066557676, 3033.0157454587343, 2875.999687279618, 2920.0013821477437,
      3042.00195184174, 3112.9979555261616, 3054.001018419231, 3060.9980381659525,
      3066.9987368427132, 2988.9994710136075, 2955.0009790926497, 3065.9993149385,
      2950.9789152465432, 3143.9984960676456, 3050.999347095845, 3089.9981477027563,
      3079.9959293904726, 3076.0009206950976, 2983.9848451923754, 2894.000992683855,
      2938.9974016489377, 2789.991148719352, 2862.003419613886, 3098.9878422198412,
      3078.0005223502717, 3247.993868309772, 3459.9948476088, 3615.9910396004293,
      3704.997439418497, 4011.994806393296, 4094.9944588809517, 4131.995731930546,
      4207.995046512819, 4275.991785677097, 4106.996402057082, 4088.990937859485,
      3988.9826160303674, 3751.992889478735, 3706.9824612218, 3596.989810141403,
      3609.990785330227, 3452.9890447535445, 3423.9835711125565, 3225.9824884177347,
      3114.9863086071723, 3024.9916713861553, 2817.984441760013, 2844.98617220776,
      2762.989298411945, 2784.98238691926, 2696.985222116251, 2662.9804814496465,
      2508.9829018575874, 2386.983281805674, 2294.98099204928, 2055.979853935232,
      1837.983159006685, 1480.9835041323201, 1397.9770965204073, 1408.9792953964802,
      1229.98016629674, 1111.9795038923044, 1039.980606567295, 996.98467522224,
      799.984641851, 747.9893206425801, 627.9880454545599, 522.9895418804712,
      422.98988404170507, 350.98957343006145, 248.00009417692152, 189.999953575493,
      138.00005, 90.000035, 70.99996, 45.99998, 22, 11.000003000000001,
      14.000012999999997, 2393.9057080230323, 2417.0020692875387, 2514.000694458296,
      2563.017321880528, 2532.999797, 2433.999413, 2423.0007940000005, 2498.001922,
      2409.999139, 2565.0004999999996, 2417.000928, 2493.000491, 2343.9995580000004,
      2394.0008780000003, 2340.998225, 2439.998669, 2440.9998259999998,
      2467.9952329999996, 2494.002532083072, 2546.001912329162, 2645.9991170290696,
      2647.0003954715003, 2796.9982727863026, 2856.0005660403654,
      2880.9978322719617, 2924.999822814294, 2868.0031066031297, 3121.9983475262397,
      3005.001121979687, 3063.9970226870446, 2978.99830070557, 3029.9994217260733,
      3026.971819678948, 3005.003043086481, 2966.0010753523175, 3010.00212126585,
      3066.999288996136, 3214.000166430688, 3220.0010166790626, 3046.0002840781153,
      3019.9961236703384, 2914.001720701056, 3006.0027022052004, 3169.999948396495,
      3051.9889565068793, 3104.001213955288, 3129.0015342641364, 3318.99614551422,
      3630.990610741485, 3823.000139231901, 3880.998099256767, 4130.993788557367,
      4148.994335160399, 4277.998515218022, 4292.999742760674, 4378.992684341522,
      4306.995051763481, 4125.995508907526, 4087.992884018522, 3998.994587606004,
      3826.992984889123, 3823.9905535547655, 3820.9882854711764, 3615.992433295567,
      3518.994255343568, 3366.98591964804, 3273.9967176599116, 3283.98579996257,
      3032.993550267603, 3063.9955070420524, 2975.988951613683, 2934.98536683575,
      2862.9896747563275, 2863.986089788837, 2760.98882943086, 2693.986051619075,
      2609.9849637976495, 2338.9810770737936, 2122.986395892048, 1884.9788185469681,
      1832.9815176567722, 1753.97586826067, 1637.9755013050499, 1625.97938551328,
      1454.9734636799542, 1412.9735780456976, 1263.9738877302561, 1216.970180032592,
      1056.973484477, 965.9702812319, 809.974811156085, 706.97319115725,
      528.969397413582, 451.98731226146106, 350.9854022758475, 247.999851,
      176.000048, 118.999926, 75.00001, 44.999992, 39.999959999999994,
      1097.8806910891412, 1034.0432544150376, 1040.000204, 1143.00011, 1045.000429,
      1053.999813, 1054.999149, 1115.000944, 1055.000508, 991.00104, 972.999014,
      1025.000004, 939.9995739999999, 909.99959, 952.999895, 872.977037,
      847.9985182238521, 816.998424685742, 769.0018294670284, 827.9994836025099,
      837.00437046513, 944.0015890532941, 970.079505144432, 1060.999183, 1094.99984,
      1187.99888, 1376.99992, 1458.000535, 1538.91908, 1735.0027238739876,
      1771.9996036629802, 1791.0029939426997, 1859.0005370054898, 1851.0032326102,
      1944.0023030490677, 1992.9990586394251, 1972.003153811584, 2075.99982789352,
      2055.000550580564, 1994.9966689909456, 1870.9548313434882, 1882.9989401217133,
      1854.9971959585748, 1809.9956151768, 1724.9956624634199, 1650.997889623996,
      1616.0018747805702, 1677.9586229254069, 1587.99686715998, 1533.0023002983257,
      1574.99411223825, 1508.0045416627845, 1574.9698944847842, 1534.0016373185981,
      1569.9977671936929, 1534.9900438622, 1377.9896176041477, 1221.9973561368952,
      1164.9804118908628, 1137.005174292254, 965.9959463087899, 902.992218064986,
      797.9821099013001, 753.994533379565, 686.990562259208, 589.0023497021559,
      499.98659608581744, 483.995762076815, 449.994344836266, 479.992987520475,
      406.00063275095, 407.9928862816399, 376.999187950025, 362.997581683614,
      287.991719541585, 317.99545239144, 317.9955219618845, 320.99525242469997,
      259.994706334875, 311.996356350781, 256.9950620223, 227.000298866704,
      169.999914692525, 178.00012262929502, 133.000120770048, 105.999974402596,
      68.00000987086, 54.999978999999996, 38.000003, 37.999984, 33.000006,
      19.000001, 19.000001, 8, 7.000001999999999, 2.000001, 2.000001, 1, 1, 1, 2,
      1041.1154334344644, 951.040321060958, 965.9991060000001, 1027.999822,
      991.999763, 998.000237, 971.000373, 1001.99871, 923.000167,
      1012.0007360000001, 946.999808, 915.99988, 895.00008, 877.00065, 897.99953,
      850.999963, 761.000061, 717.99994, 665.00037, 706.000185, 687.000751,
      781.0002, 845.000243, 926.906855, 1013.102645181475, 1043.000188, 1186.914552,
      1325.006722406249, 1445.00208984649, 1483.0019833464996, 1525.004123787648,
      1582.002683113696, 1657.0019880788689, 1691.002134966456, 1761.0001520716248,
      1785.9982592722104, 1733.000929156048, 1751.999525957524, 1742.99972298848,
      1749.996445542402, 1626.0007115415692, 1624.996138291841, 1522.000352839204,
      1499.9995653473602, 1512.0003080975039, 1430.998939896953, 1381.0013228000748,
      1434.998346644976, 1342.99808989929, 1257.001200746236, 1295.998857176016,
      1229.97453367278, 1222.99898572188, 1187.99824193586, 1117.9995140331218,
      1120.9957467333602, 1026.99461072459, 913.99757350071, 855.984198505035,
      886.0091970000001, 761.996751508769, 677.9968278975899, 602.9993342750998,
      580.9859065736875, 548.997401931641, 516.006370320936, 438.98818497288005,
      416.99811547862197, 388.999593285716, 381.99924377272, 371.0008000006875,
      387.99283028543596, 295.00111388447493, 304.99502398052005, 240.996536205525,
      271.99562586954596, 224.9978276266215, 259.99747961321003, 238.99506679508002,
      245.99538587919403, 238.99399988033804, 196.99618148654997, 176.98732752172,
      130.99287986232497, 129.994596536092, 94.993114774508, 88.99650888660099,
      60.990969880600005, 57.990012346149996, 40.99236371277, 30.0047809285725,
      25.991214333334998, 22.996534499999996, 15.999995, 8, 9.000002, 9, 2.000001,
      4, 1, 1
    ),
    BIRTHS = rep(
      c(
        2482.0959142935653, 0, 2363.9008707557787, 0, 1107.8758826222504, 0,
        1055.1198882116666, 0, NA
      ),
      c(1L, 100L, 1L, 100L, 1L, 100L, 1L, 100L, 404L)
    ),
    MOR = rep(
      c(
        10.924483980215555, 1.9759462543945001, 0.99997481406, 0.982756100746, 0,
        0.005044, 1.00073418818, 0.9997457884, 0.99991290132, 1.0001478394759997,
        1.001019019788, 1.000181075849, 1.0041920347989999, 1.9998295074349999,
        2.00003561486, 1.9991423999609998, 2.00073700702, 1.9988013442319998,
        1.982866541266, 0.998705720382, 0.997753852256, 0.99901315826,
        1.0018814738385, 0.999475580769, 1.0009468340475, 1.002225157287,
        1.0004479863920002, 0.99847590735, 1.0010600615, 1.019638753457,
        2.0028529323544997, 2.000362904155, 2.0012312972435002, 2.0013516095275,
        2.0000103049024998, 2.0145848076250004, 3.000569316145, 3.0032813510620002,
        3.0112162806475, 3.9964183861140006, 4.0118187801584995, 4.998435649728,
        5.005730690227501, 6.006752391200001, 7.008341399570001, 8.004023581502999,
        9.006625606704, 10.005229119048002, 11.004696069453999, 12.003891487180999,
        13.010403322902, 14.005915942918001, 15.010232140514999, 16.014117969633,
        17.006012521265, 18.0153787782, 20.010680858597, 22.009600669773,
        23.013446246455505, 25.0150198874435, 26.018658582265, 28.013330392828003,
        30.009471613844497, 30.015224239987, 34.01260779224, 36.01203658805499,
        40.01515308074, 43.0143808837485, 47.017679550352995, 50.0175731424125,
        53.016920194326, 57.01966395072, 58.020952064768004, 59.018125993315,
        54.01617586767999, 58.02232547959301, 68.01923260352, 68.01989870326,
        70.0204491076955, 75.019391432705, 83.01508477776001, 76.01510814900001,
        80.01105935742001, 76.01189054544, 71.010460119529, 63.01004595829499,
        57.01042756993849, 43.99989682307851, 38.000003424507, 31.999950000000002,
        24.999965, 24.000040000000002, 19.00002, 10, 5.9999970000000005, 12.999987,
        7.965681266177455, 0.9989497124615, 0.9995135417040001, 0.9832861194720001, 0,
        0.006262, 0.999531916928, 0.9989526708375, 1.0007299709300002,
        0.9997545285000001, 1.0001322136975002, 0.9992039596350001, 1.000604728038,
        1.0012631857060001, 0.9963023968705002, 1.00148847376, 0.9990000203130001,
        1.0018333129559998, 1.00047929443, 0.9992122739270001, 1.027102321052,
        1.9996879135194998, 1.9993596476824997, 1.99857873415, 1.9976740038640002,
        1.998457569312, 2.0000103209374998, 1.9994799218840003, 2.001869329662,
        1.9991432989440001, 1.9981777948000001, 2.000377603505, 2.0095074931199997,
        2.9988780447120003, 2.997917735864, 3.0049244857799993, 4.007144258515,
        5.0002697680995, 5.003826743233, 6.008194442632499, 7.004882839601,
        8.000182781979, 8.002661239326, 9.0064966584775, 10.00644523652,
        11.005687092474, 12.006420981477502, 13.004114393994998, 13.0053101108775,
        14.009416445235, 16.010290528823997, 17.008721704432496, 18.003447656431998,
        18.013648351960004, 20.003394340088004, 21.01374003743, 22.006791732396998,
        24.006024957948, 25.010541386316994, 27.014669164249998, 30.010661243671997,
        33.013245211162506, 36.01320056914, 39.014842380924996, 43.014136202349995,
        43.019246926205994, 45.015348107952, 45.020277453032, 51.017400343228,
        55.02431173933, 60.02419869495001, 69.02046648672001, 71.02629232004601,
        81.0263649543025, 85.02524826974401, 96.029531967408, 98.026115523,
        105.02943876810001, 103.02507084391499, 105.02645884275, 91.03067858641799,
        91.01248173853901, 84.01453272415249, 71.000149, 61.999952, 52.000074,
        39.999990000000004, 29.000008, 50.000040000000006, 3.9993523725546223,
        0.9569205849625, 0, 0.023440000000000003, 1.001099776148, 1.001269314258,
        0.9982215329715001, 1.00034639749, 0.9948575348700001, 0.999238946706,
        0.9202228555680001, 0, 0.080648, 0.9977011260125, 0.99983433702,
        0.9972060573000001, 0.99944299451, 0.9963673898000001, 0.997508950932,
        1.000391360575, 0.997582188416, 1.00061210648, 1.001168419436, 1.003367009054,
        1.045752656512, 2.0008308782864996, 2.0019540414250003, 2.0040648232000002,
        2.00353853658, 2.001082376004, 1.99686521943, 2.039823074593,
        3.0034928400200003, 2.9979057016740005, 3.00458776175, 2.9962993372155005,
        3.030121515216, 3.997734681402, 4.001686806306999, 4.010062137799999,
        4.010310395852, 4.003173863105, 4.019946109137, 4.995151707746, 4.00439169121,
        4.007980935013999, 4.0179300987, 5.005503620435, 5.009645740791999,
        4.997114297844, 4.0140189141825005, 5.003927923185, 5.005411163733999,
        6.006602479525001, 5.999677249049999, 6.00735171836, 7.001202049974999,
        7.002822316386, 6.008325458414999, 8.004515608559998, 9.004007038115502,
        10.004752575300001, 9.005243665125, 12.003949649218999, 11.0048879777,
        10.999925133296, 10.000060307475, 10.999907370705001, 9.999943229952,
        8.999989597404001, 6.99998212914, 6.000021, 4.999997, 6.0000160000000005,
        5.999994, 3.9999990000000003, 2, 1.999998, 0.999999, 1, 0, 2,
        5.000091523706029, 0.9595629390420001, 0, 0.09333, 0.897004818525, 0,
        0.08523800000000001, 0.992238593751, 0.9983401535099999, 0.9970166535,
        0.996508212352, 0.9969648863039999, 0.9993859211310001, 0.9979770335440001,
        0.9995979283750002, 1.0007737277895001, 1.000254843952, 1.000622042476,
        1.00031701152, 1.0034064575980002, 1.000774458431, 1.002915708159,
        1.0001351607959998, 0.99939465264, 1.000907902496, 1.001354103047,
        0.9992271999249999, 1.001237355024, 1.00218010071, 0.999435253764,
        1.0006868239839999, 1.02504232722, 2.0013542781200004, 2.00242806414,
        1.9998899668780001, 2.00342926664, 2.00464227541, 2.0019664992900004,
        2.015366494965, 2.990803, 2.003625491231, 2.0032421024100002, 2.0011057249,
        2.0137584263124997, 3.002437068359, 2.993517679064, 2.01182702712,
        3.0018905213780003, 3.0004627142839997, 3.00068622728, 2.9990749993125,
        3.0072257145639996, 2.9993071155249997, 3.0049800194800005,
        3.0033487944749995, 4.004530130454, 4.0020433733785, 5.00245538679,
        5.00495320492, 6.0045401208059985, 7.005938119662001, 7.0038485134499995,
        7.012592478279999, 7.007086137675, 8.005471463908, 7.0068772254919995,
        8.003518113399, 6.0090551194, 7.00996265385, 6.00761728723, 4.9952340714275,
        4.008795666665001, 4.0034655, 3.0000050000000003, 2, 1.9999980000000002, 3,
        0.999999, 1, NA
      ),
      rep(
        c(1L, 6L, 1L, 13L, 1L, 13L, 1L, 5L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 21L, 1L, 3L, 404L),
        c(4L, 1L, 95L, 1L, 86L, 1L, 8L, 1L, 63L, 1L, 2L, 1L, 1L, 1L, 3L, 1L, 75L, 1L, 1L)
      )
    ),
    EMI_INT = rep(
      c(
        5.999225824847547, 15.000916, 13.998723, 12.999215999999999, 11.001125,
        10.99989, 9.999072, 7.999866, 7.000090999999999, 6.000252000000001, 4.99888,
        3.99984, 2.9992840000000003, 2.999202, 1.99949, 2.001138, 2.000238, 2.000115,
        3.000395, 4.999014, 7.000884, 8.998963999999999, 9.998964, 12.00148,
        13.001370000000001, 15.00004, 15.998584000000001, 17, 16.999422,
        17.001360000000002, 16.999977, 16.0002, 15.000836000000001, 16.000649,
        14.001108, 14.99916, 13.000332, 13.001397, 13.000468, 12.001116, 11.001192,
        9.998664, 10.000444, 9.99908, 9.999784, 10.001292000000001,
        10.000017999999999, 10.001433, 9.999285, 10.001290000000001, 10.000879,
        10.998749, 10.001715999999998, 10.0007, 10.999251, 11.999925, 11.99828,
        13.000704, 13.001496000000001, 13.001777, 13.001174, 12.9996, 12.999168,
        13.000098, 15.999984, 11.998844, 9.000244, 8.00014, 7.000184,
        5.9995650000000005, 6.001, 4.999588, 5.000814, 3.9991480000000004,
        3.9999599999999997, 2.999876, 1.999117, 1.9992249999999998,
        0.9995160000000001, 1.0003520000000001, 1.000728, 0.999987, 1.000307, 0,
        7.999440546637555, 8.999322, 9.000552, 9.000584, 8.999188, 7.999587, 7.9993,
        7.999392, 8.000258, 7.000240000000001, 6.998992, 5.999744000000001, 5.000706,
        4.999197000000001, 5.000805, 4.000352, 3.99924, 4.998798000000001,
        7.9988790000000005, 7.9988600000000005, 9.000257, 11.999064, 14.001, 17.0001,
        18.000264, 21.000932, 21.00099, 21.000832, 19.000737, 17.999928, 17.001,
        13.998834999999998, 12.998581000000001, 11.000150000000001, 10.00093, 8.99996,
        7.999133, 8.000608, 7.000902, 6.999616, 7.0004, 6.9991140000000005,
        6.9996160000000005, 7.00124, 7.001115, 7.998975000000001, 8.001422,
        9.000767999999999, 8.999188, 8.999244, 9.001674, 9.00126, 8.9985, 8.999889,
        8.999784, 8.00056, 8.000216, 7.00175, 7.001064, 6.999237, 7.001064, 6.998412,
        9.000672, 6.999608, 6.998792, 4.9995, 3.9985500000000003, 3.9986509999999997,
        3.99966, 3.00034, 3.000632, 2.99922, 2.9990349999999997, 2.998638, 2.9998,
        2.999919, 1.999218, 2.000226, 1.0006920000000001, 0.99997, 1.00005, 0.99946,
        0.999744, 1.00031, 1.000216, 0.999744, 1.000518, 1.00045, 0.999735, 0,
        4.9998438582742155, 37.999825, 32.999828, 32.00056, 25.999577000000002,
        23.000235999999997, 19.000331, 17.999616, 14.99959, 11.99968, 9.00041,
        9.000138, 7.00033, 5.99963, 5.000226, 3.9997399999999996, 5.999994, 11.000001,
        15.999984, 21.999979999999997, 25.000308, 30.999627, 36.000288000000005,
        40.000275, 41.000352, 45.000416, 52.999705, 54.999774, 56.999872,
        62.99981999999999, 62.00042200000001, 60.999399999999994, 61.000600000000006,
        60.000387999999994, 61.00015199999999, 62.000249999999994, 60.999488,
        62.999952, 60.999367, 59.000123, 55.000516, 53.999413, 51.9998, 51.000064,
        48.000411, 43.000764000000004, 41.00026, 42.00034, 39.00051, 36.000305,
        35.00058, 32.999868, 32.999864, 29.999945, 30.00044, 27.99929,
        26.000400000000003, 24.99975, 29.00037, 31.999482, 29.000232, 25.999987,
        25.999974, 24.999975000000003, 26.000104, 36.99997, 17.999765, 10.000042,
        7.000072, 6.000050000000001, 4.9999199999999995, 3.999864, 2.99992,
        2.9999059999999997, 2.9998549999999997, 2.999888, 3.0001510000000002,
        2.999997, 1.9998900000000002, 2.00001, 1.9998900000000002, 1.999888,
        1.0000250000000002, 0.99997, 0.9999359999999999, 1.000036, 1.000008, 0,
        13.001187262544157, 41.000462999999996, 33.000448, 27.99954,
        22.000230000000002, 18.999679, 15.999689, 15.000454, 12.99997, 12.999792,
        12.000456000000002, 11.000274999999998, 9.999808, 8.999578,
        10.000250000000001, 9.000327, 7.999992, 8.00007, 7.9998, 9.99972, 10.999701,
        12.99984, 15.999792, 18.99959, 24.00045, 28.000238, 33.000282, 37.000167,
        40.000289, 41.0004, 42.999808, 43.000628, 44.999214, 43.999952, 44.00082,
        41.999949, 37.999598999999996, 34.999668, 32.999750000000006, 30.000724,
        25.999743, 23.999794, 20.999878000000002, 19.00062, 17.999712000000002,
        17.00001, 15.00013, 15.999736, 13.999494, 12.999592000000002, 13.000104,
        13.00032, 12.999450000000001, 14.00022, 17.0005, 18.000025, 18.000024,
        17.999785, 18.9999, 15.999792, 13.000100999999999, 10.999758000000002,
        9.000225, 22.000167, 12.999888, 7.999992, 4.999855999999999, 3.999968,
        4.00015, 4.000125, 3.999968, 2.999867, 2.99992, 3.0000250000000004, 1.999896,
        2.000086, 1.999955, 2.0000679999999997, 1.9999650000000002, 1.999959, 1.99998,
        2.00008, 2.0000340000000003, 1.999932, 1.000008, 0.999973, 0.9999750000000001,
        1.000025, 1.000019, 0.999985, 0.99999, 0, NA
      ),
      rep(
        c(1L, 2L, 1L, 17L, 1L, 2L, 1L, 2L, 1L, 10L, 1L, 14L, 1L, 2L, 1L, 9L, 404L),
        c(62L, 1L, 20L, 1L, 15L, 1L, 3L, 1L, 69L, 1L, 87L, 1L, 50L, 1L, 40L, 1L, 1L)
      )
    ),
    EMI_NAT = rep(
      c(
        21.001013530837856, 72.99978, 60.999429, 49.000008, 41.999264999999994,
        35.99964, 29.999823999999997, 26.000849, 23.000299000000002,
        21.000881999999997, 18.000992, 17.99928, 15.999396, 15.999096, 16.000982,
        15.998868, 15.999333, 16.99971, 19.000825, 26.999154, 37.001151,
        53.000834000000005, 75.999708, 103.00012, 120.000525, 143.00116, 165.000276,
        178, 176.000132, 173.00016000000002, 163.998879, 149.000381, 133.999089,
        125.99867, 109.001154, 103.999341, 89.99999, 81.999, 74.00149900000001,
        66.998666, 58.99892, 52.999752, 49.999323, 43.998699, 43.001048, 44.999682,
        42.001293999999994, 42.999402, 43.998915, 44.998615, 44.998422000000005,
        46.999747, 45.998092, 45.999096, 45.001521, 43.9983, 40.999602, 38.998016,
        37.00149, 32.999014, 32.0006, 28.999941, 28.00044, 25.998336, 24.000975,
        33.999152, 25.001261999999997, 18.998819, 16.00028, 15.001216000000001,
        13.998985, 14.001392, 12.000653999999999, 12.000869999999999, 10.000427,
        8.99991, 8.999628, 7.000076, 5.99957, 5.000646000000001, 5.000306, 5.000688,
        3.999948, 2.99974, 3.0000020000000003, 3.0002400000000002, 2.00025, 1.99962,
        2.000064, 1.9999980000000002, 1.00007, 0.999999, 1.000009, 1.000043, 0,
        24.998251708242357, 65.999782, 58.999224, 52.998951999999996, 45.000934,
        38.001042000000005, 31.999595, 28.999032, 24.000774, 21.99894, 16.999944,
        14.999360000000001, 11.999844, 11.000119, 9.00099, 10.00088, 10.999776,
        16.999185, 26.998908, 45.000291, 70.00116, 98.00110000000001, 135.001078,
        168.001086, 194.00072799999998, 213.99885, 216.000309, 233.999664, 214.998572,
        203.000912, 178.000515, 161.00136, 141, 120.998626, 103.00067399999999,
        89.99961, 80.001388, 73.001084, 63.999410000000005, 53.999616, 49.000376,
        43.000096, 40.998960000000004, 41.000616, 37.001408, 35.998936, 34.999393,
        36.000315, 38.001353, 38.99826, 38.999054, 39.998925, 38.998988, 38.999772,
        37.999379999999995, 38.001474, 35.999136, 33.998256, 32.000864, 30.999748,
        29.000576, 28.000779, 27.000272, 25.000548000000002, 35.001434, 36.000888,
        27.000984, 22.0011, 18.0011, 16.999662, 15.000972, 13.999616,
        12.998887999999999, 13.001445, 11.998935, 11.000468000000001, 10.0011,
        8.999756999999999, 7.9990380000000005, 6.000678, 6.00039, 4.9998499999999995,
        5.00025, 5.000688, 4.000500000000001, 3.9997469999999997, 3.000648, 3.000544,
        1.999882, 1.99983, 2.000383, 1.00035, 0.999924, 1.0002060000000002, 1.000065,
        0, 9.99857984066581, 27.999925, 26.000176, 24.999584000000002, 19.999913,
        16.999857000000002, 15.000426000000001, 13.999824, 11.000394, 8.99976,
        8.000258, 6.999768, 6.0000160000000005, 5.00045, 5.000226, 4.999675000000001,
        5.000424, 6.000302, 7.999992, 13.00029, 20.000082, 29.999726999999996,
        38.000304, 48.00033, 53.99952, 63.000368, 77.00055, 82.999854,
        88.00035199999999, 98.99925, 99.00032200000001, 97.9999, 99.00004, 95.000318,
        95.99922, 96.00045, 90.99974399999999, 91.999832, 86.99966599999999,
        80.999128, 71.999358, 70.000838, 66.0006, 61.000111999999994, 54.999718,
        49.999629, 47.00073, 47.00078, 41.99933, 39.000203, 37.999956,
        33.999362999999995, 34.000624, 28.000459, 27.000396, 25.000189999999996,
        20.999472, 16.99983, 15.999552, 14.000499, 10.999816, 9.999782,
        7.999992000000001, 6.999993, 6.000024000000001, 4.000283, 2.9998750000000003,
        3.0000620000000002, 2.000086, 2.00018, 1.9998850000000001, 0.999966, 0.999845,
        1.0000499999999999, 1.000072, 1.0001600000000002, 0.999999,
        1.0000799999999999, 0.9998419999999999, 1.0000799999999999, 0.999944, 0,
        10.001481420358388, 19.99953, 19.000462000000002, 19.000494,
        17.000087999999998, 16.000042, 15.000249, 14.000490000000001, 11.999692,
        12.999792, 10.999872, 10.000250000000001, 9.000004, 8.999578,
        8.000200000000001, 7.999809000000001, 6.999993, 8.00007, 11.00006,
        18.000059999999998, 24.999681, 34.99985, 42.000225, 49.000305, 54.999735,
        55.999537999999994, 62.999946, 68.00044, 70.999597, 70, 67.999528, 65.999802,
        65.99949000000001, 62.999744, 61.99974, 59.000558000000005, 52.999936,
        50.000516, 47.000640000000004, 43.999435999999996, 37.9995,
        35.000575999999995, 29.999394, 28.000363999999998, 25.999584000000002,
        22.999428, 20.99936, 24.000320000000002, 23.999706000000003, 23.000335,
        23.000183999999997, 21.000168, 19.999460000000003, 18.00015,
        16.000092000000002, 14.99978, 13.000305, 11.000424, 10.000265, 9.9999,
        7.999896, 6.999843, 4.999890000000001, 4.999995, 4.000185, 5.000159999999999,
        3.000108, 2.999998, 1.999984, 2.000075, 1.999875, 1.999984,
        0.9998560000000001, 1.000076, 1.00009, 0.999948, 1.000043, 1.00011, 0.999912,
        1.000109, 1.000103, 0.99999, 0, NA
      ),
      rep(
        c(1L, 7L, 1L, 6L, 1L, 2L, 1L, 19L, 1L, 19L, 404L),
        c(94L, 1L, 95L, 1L, 72L, 1L, 8L, 1L, 82L, 1L, 1L)
      )
    ),
    IMM_INT = rep(
      c(
        2, 15, 14, 13, 11, 10, 9, 8, 7, 6, 5, 4, 3, 4, 5, 6, 8, 9, 10, 12, 13, 14, 15,
        16, 15, 14, 13, 12, 11, 10, 11, 12, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1,
        0, 4, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 5, 6, 8, 11, 13, 14, 16, 17, 16, 15,
        13, 11, 10, 8, 7, 8, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 23, 54, 51, 48, 47, 45, 44,
        43, 42, 41, 40, 38, 37, 34, 33, 32, 35, 45, 61, 84, 106, 128, 145, 158, 166,
        169, 166, 161, 155, 148, 140, 132, 124, 117, 110, 103, 97, 91, 86, 81, 76, 72,
        68, 64, 60, 57, 54, 51, 49, 45, 42, 37, 33, 29, 25, 21, 18, 15, 13, 11, 9, 8,
        7, 6, 5, 4, 3, 2, 1, 0, 20, 46, 42, 40, 39, 38, 39, 40, 39, 37, 36, 35, 36,
        46, 64, 87, 109, 128, 140, 145, 148, 145, 141, 135, 128, 121, 113, 106, 99,
        92, 85, 80, 74, 69, 64, 59, 56, 52, 49, 46, 44, 42, 40, 38, 36, 35, 33, 30,
        27, 25, 21, 19, 16, 14, 12, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, NA
      ),
      rep(
        c(
          1L, 2L, 1L, 2L, 1L, 2L, 1L, 5L, 1L, 2L, 3L, 1L, 2L, 1L, 3L, 4L, 2L, 5L, 4L,
          5L, 8L, 9L, 1L, 2L, 1L, 2L, 1L, 2L, 3L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 7L,
          6L, 4L, 6L, 4L, 6L, 5L, 10L, 8L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 4L, 6L, 20L,
          1L, 2L, 3L, 1L, 2L, 1L, 3L, 2L, 7L, 14L, 8L, 404L
        ),
        c(
          1L, 1L, 9L, 1L, 1L, 1L, 8L, 1L, 2L, 4L, 1L, 2L, 2L, 1L, 3L, 1L, 1L, 2L, 1L,
          1L, 1L, 1L, 1L, 1L, 3L, 1L, 3L, 1L, 1L, 1L, 1L, 4L, 2L, 2L, 1L, 2L, 2L, 1L,
          1L, 1L, 1L, 3L, 1L, 1L, 1L, 1L, 8L, 1L, 1L, 1L, 14L, 1L, 40L, 1L, 1L, 1L, 1L,
          4L, 1L, 2L, 5L, 1L, 48L, 1L, 1L, 1L, 1L, 1L, 1L
        )
      )
    ),
    IMM_NAT = rep(
      c(
        38, 107, 87, 72, 58, 46, 37, 32, 25, 22, 20, 18, 17, 16, 17, 18, 21, 25, 32,
        43, 60, 81, 104, 120, 136, 147, 159, 163, 159, 157, 145, 138, 126, 120, 109,
        101, 92, 84, 76, 69, 64, 59, 55, 54, 52, 51, 50, 49, 48, 47, 44, 41, 39, 37,
        35, 34, 33, 32, 34, 37, 27, 23, 20, 18, 16, 15, 14, 13, 11, 10, 9, 8, 6, 5, 4,
        3, 2, 1, 0, 52, 88, 82, 72, 61, 51, 43, 36, 31, 27, 24, 22, 21, 20, 19, 21,
        25, 31, 45, 67, 98, 131, 163, 181, 195, 206, 213, 207, 197, 180, 167, 147,
        135, 119, 105, 92, 86, 77, 72, 65, 59, 55, 53, 49, 48, 47, 45, 46, 45, 46, 45,
        43, 42, 39, 37, 35, 33, 31, 29, 36, 33, 30, 26, 22, 21, 19, 18, 17, 15, 14,
        13, 12, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 12, 35, 36, 32, 28, 24, 20, 18, 15,
        14, 12, 11, 9, 7, 6, 5, 7, 9, 16, 23, 33, 44, 53, 64, 74, 86, 96, 103, 111,
        112, 116, 115, 116, 111, 106, 103, 97, 94, 84, 80, 75, 70, 65, 62, 56, 55, 52,
        49, 47, 44, 42, 40, 36, 35, 30, 24, 21, 19, 16, 14, 12, 10, 9, 6, 5, 4, 3, 2,
        1, 0, 9, 31, 30, 27, 23, 21, 19, 17, 16, 15, 14, 13, 12, 11, 10, 11, 14, 17,
        25, 35, 43, 52, 59, 64, 70, 77, 81, 83, 84, 83, 78, 75, 73, 69, 63, 60, 56,
        52, 46, 43, 40, 37, 34, 33, 31, 29, 28, 26, 25, 23, 21, 20, 17, 14, 13, 11,
        10, 8, 7, 6, 5, 4, 3, 2, 1, 0, NA
      ),
      rep(
        c(
          1L, 2L, 1L, 2L, 1L, 3L, 2L, 1L, 2L, 5L, 9L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L,
          1L, 2L, 1L, 2L, 1L, 2L, 3L, 2L, 6L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 8L, 2L,
          20L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 2L, 1L, 5L, 2L, 10L, 17L, 404L
        ),
        c(
          14L, 1L, 12L, 1L, 17L, 1L, 2L, 25L, 4L, 1L, 1L, 15L, 1L, 33L, 3L, 6L, 1L, 11L,
          1L, 3L, 1L, 1L, 1L, 1L, 2L, 1L, 1L, 1L, 14L, 1L, 16L, 1L, 30L, 1L, 3L, 1L, 1L,
          1L, 1L, 13L, 2L, 30L, 1L, 5L, 1L, 7L, 1L, 2L, 1L, 1L, 1L, 1L, 1L
        )
      )
    ),
    ACQ = rep(
      c(
        0, 25.99741546161373, 13.000074999999999, 15.999792, 17.999746000000002,
        17.000080999999998, 18.000094, 17.999616, 17.999508000000002, 17.99952,
        21.000318, 28.00009, 30.000080000000004, 34.00033, 38.999653,
        39.000108000000004, 35.999964, 33.000003, 26.999973, 26.999900000000004,
        23.000382, 19.999818, 16.99968, 13.000212, 11.000288, 8.000336,
        9.999825000000001, 9.999837, 12.000048000000001, 14.000504999999999,
        16.999817999999998, 20.0005, 22.99938, 25.999694, 30.000816, 32.99985,
        34.000032000000004, 36.999776000000004, 36.999247999999994,
        36.000713000000005, 33.999542, 33.999978000000006, 31.00045, 30.000144,
        28.00067, 25.000635, 24.00027, 24.000434, 21.9998, 20.999285999999998,
        19.000764, 17.999928, 17.999496, 17.000224, 15.99971, 14.000414,
        13.000200000000001, 10.999889999999999, 9.99972, 9.999693, 6.999614, 7.000032,
        5.999994, 4.999995, 4.999664, 4.000283, 1.999745, 2.000206, 2.000086, 2.00018,
        1.9998850000000001, 1.999932, 0.999845, 1.0000499999999999, 1.000072,
        1.0001600000000002, 0.999999, 1.0000799999999999, 0.9998419999999999,
        1.0000799999999999, 0.999944, 0, 15.001694570593477, 15.000122999999999,
        15.999984000000001, 18.000144, 17.999919, 16.000042, 15.999689, 18.000346,
        17.000171, 19.99968, 18.999864000000002, 19.999595, 22.000108, 29.000194,
        37.00002, 44.999901, 45.999953999999995, 42.999919999999996, 35.99977,
        34.000035, 26.999867000000002, 23.00011, 19.999740000000003, 19.99992,
        21.000165, 20.000036, 20.999982, 22.000432, 21.999684000000002, 23.0006,
        23.000031999999997, 25.999922, 28.999921999999998, 30.000192000000002,
        33.99969, 36.000460000000004, 33.999280999999996, 34.999668, 35.99957,
        37.999988, 35.999271, 35.000575999999995, 33.00024, 33.000056, 31.999488,
        29.000268, 26.99996, 27.00036, 25.00053, 20.999437, 21.000168000000002,
        19.000152, 17.99988, 14.999730000000001, 13.000283999999999, 14.000544,
        11.000417, 9.000012, 8.000385, 7.0002, 4.999935000000001, 4.999986, 3.999912,
        2.000115, 1.9998090000000002, 2.000064, 0.999888, 1.00014, 0.999992, 0.999845,
        1.000125, 0.999992, 0.9998560000000001, 0, NA
      ),
      rep(
        c(202L, 1L, 2L, 1L, 2L, 1L, 19L, 1L, 28L, 404L),
        c(1L, 5L, 1L, 65L, 1L, 8L, 1L, 73L, 1L, 1L)
      )
    ),
    MIG_SUB = numeric(808)
  )

  # run complement_projection
  output_table <- complement_projection(empty_df, raw_df, subregional = TRUE)

  # run tests
  expect_snapshot(constructive::construct(output_table))
})
